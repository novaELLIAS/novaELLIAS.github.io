<!DOCTYPE html>
<html>
<head hexo-theme='https://github.com/volantis-x/hexo-theme-volantis/tree/4.0.0-rc.3'>
  <meta charset="utf-8">
  <!-- SEO相关 -->
  
    
  
  <!-- 渲染优化 -->
  <meta name="renderer" content="webkit">
  <meta name="force-rendering" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
  <meta name="HandheldFriendly" content="True" >
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta http-equiv='x-dns-prefetch-control' content='on' />

  <!-- 页面元数据 -->
  
  <title>HongYanAsstHardware - Next Dream...</title>
  

  
    <meta name="description" content="
信息与通信工程导论项目 HongYanAsst 骑行安全监控系统 Wiki

">
  

  <!-- feed -->
  

  <!-- import meta -->
  

  <!-- link -->
  <link rel='dns-prefetch' href='https://cdn.jsdelivr.net'>
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.14/css/all.min.css">

  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/l-lin/font-awesome-animation/dist/font-awesome-animation.min.css">

  

  

  
    <link rel="shortcut icon" type='image/x-icon' href="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.3.12/img/magician1_for_favicon.png">
  

  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer@1.10/dist/APlayer.min.css">
  

  

  <!-- import link -->
  

  
  
    
<link rel="stylesheet" href="/css/style.css">

  
  
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script>
	setTimeout(function() {
  	  window.ga_tid = 'UA-141886684-1';
 	   (function() {
 	     var dga = document.createElement("script");
 	     dga.src = "https://rmt.dogedoge.com/fetch/public/ga.js";
	      var s = document.getElementsByTagName("script")[0];
	      s.parentNode.insertBefore(dga, s);
	  })();
	}, 5000);
    </script>
  
  
  <!-- 脚本懒加载函数 -->
  <script>
  function loadScript(src, cb) {
    var HEAD = document.getElementsByTagName('head')[0] || document.documentElement;
    var script = document.createElement('script');
    script.setAttribute('type','text/javascript');
    if (cb) script.onload = cb;
    script.setAttribute('src', src);
    HEAD.appendChild(script);
  }
  //https://github.com/filamentgroup/loadCSS
  !function(c){"use strict";var e=function(e,t,n,r){var o,i=c.document,a=i.createElement("link");if(t)o=t;else{var d=(i.body||i.getElementsByTagName("head")[0]).childNodes;o=d[d.length-1]}var f=i.styleSheets;if(r)for(var l in r)r.hasOwnProperty(l)&&a.setAttribute(l,r[l]);a.rel="stylesheet",a.href=e,a.media="only x",function e(t){if(i.body)return t();setTimeout(function(){e(t)})}(function(){o.parentNode.insertBefore(a,t?o:o.nextSibling)});var s=function(e){for(var t=a.href,n=f.length;n--;)if(f[n].href===t)return e();setTimeout(function(){s(e)})};function u(){a.addEventListener&&a.removeEventListener("load",u),a.media=n||"all"}return a.addEventListener&&a.addEventListener("load",u),(a.onloadcssdefined=s)(u),a};"undefined"!=typeof exports?exports.loadCSS=e:c.loadCSS=e}("undefined"!=typeof global?global:this);
  </script>
  <script id="loadcss"></script>
</head>

<body>
  <header class="l_header auto shadow floatable blur " style='opacity: 0' >
  <div class='container'>
  <div class='wrapper'>
    <div class='nav-sub'>
      <p class="title"></p>
      <ul class='switcher nav-list-h m-phone' id="pjax-header-nav-list">
        <li><a class="s-comment fas fa-comments fa-fw" target="_self" href='javascript:void(0)'></a></li>
        
          <li><a class="s-toc fas fa-list fa-fw" target="_self" href='javascript:void(0)'></a></li>
        
      </ul>
    </div>
		<div class="nav-main">
      
        
        <a class="title flat-box" target="_self" href='/'>
          
          
          
            NextDream
          
        </a>
      

			<div class='menu navigation'>
				<ul class='nav-list-h m-pc'>
          
          
          
            
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" 
                  
                  
                  >
                  <i class='fas fa-rss fa-fw'></i>Blog
                </a>
                
                  <ul class="list-v">
                    
                      
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href=/
                  
                  
                  
                    id="home"
                  >
                  <i class='fas fa-align-left fa-fw'></i>Article
                </a>
                
              </li>
            
          
                    
                      
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href=/archives
                  
                  
                  
                    id="archives"
                  >
                  <i class='fas fa-archive fa-fw'></i>Archive
                </a>
                
              </li>
            
          
                    
                      
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href=/categories/
                  
                  
                  
                    id="categories"
                  >
                  <i class='fas fa-folder-open fa-fw'></i>Categories
                </a>
                
              </li>
            
          
                    
                      
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href=/tags/
                  
                  
                  
                    id="tags"
                  >
                  <i class='fas fa-tags fa-fw'></i>Tags
                </a>
                
              </li>
            
          
                    
                  </ul>
                
              </li>
            
          
          
            
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href=/webboard/
                  
                  
                  
                    id="webboard"
                  >
                  <i class='fas fa-comment-alt fa-fw'></i>Web Board
                </a>
                
              </li>
            
          
          
            
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href=/friends/
                  
                  
                  
                    id="friends"
                  >
                  <i class='fas fa-link fa-fw'></i>Friends
                </a>
                
              </li>
            
          
          
            
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" 
                  
                  
                  >
                  <i class='fas fa-info-circle fa-fw'></i>About
                </a>
                
                  <ul class="list-v">
                    
                      
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href=/aboutme/
                  
                  
                  
                    id="aboutme"
                  >
                  <i class='fas fa-address-card fa-fw'></i>About me
                </a>
                
              </li>
            
          
                    
                      
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href=/bloghistory/
                  
                  
                  
                    id="bloghistory"
                  >
                  <i class='fas fa-calendar fa-fw'></i>Blog History
                </a>
                
              </li>
            
          
                    
                  </ul>
                
              </li>
            
          
          
            
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" 
                  
                  
                  >
                  <i class='fas fa-ellipsis-h fa-fw'></i>More
                </a>
                
                  <ul class="list-v">
                    
                      
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href=/hiddenlist/
                  
                  
                  
                    id="hiddenlist"
                  >
                  <i class='fab fa-buffer fa-fw'></i>HiddenList
                </a>
                
              </li>
            
          
                    
                      
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href=/gallerypage/
                  
                  
                  
                    id="gallerypage"
                  >
                  <i class='fas fa-images fa-fw'></i>Gallery
                </a>
                
              </li>
            
          
                    
                      
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href=/donatepage/
                  
                  
                  
                    id="donatepage"
                  >
                  <i class='fas fa-heart fa-fw'></i>Donate
                </a>
                
              </li>
            
          
                    
                  </ul>
                
              </li>
            
          
          
				</ul>
			</div>

      <div class="m_search">
        <form name="searchform" class="form u-search-form">
          <i class="icon fas fa-search fa-fw"></i>
          <input type="text" class="input u-search-input" placeholder="Search..." />
        </form>
      </div>

			<ul class='switcher nav-list-h m-phone'>
				
					<li><a class="s-search fas fa-search fa-fw" target="_self" href='javascript:void(0)'></a></li>
				
				<li>
          <a class="s-menu fas fa-bars fa-fw" target="_self" href='javascript:void(0)'></a>
          <ul class="menu-phone list-v navigation white-box">
            
              
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" 
                  
                  
                  >
                  <i class='fas fa-rss fa-fw'></i>Blog
                </a>
                
                  <ul class="list-v">
                    
                      
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href=/
                  
                  
                  
                    id="home"
                  >
                  <i class='fas fa-align-left fa-fw'></i>Article
                </a>
                
              </li>
            
          
                    
                      
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href=/archives
                  
                  
                  
                    id="archives"
                  >
                  <i class='fas fa-archive fa-fw'></i>Archive
                </a>
                
              </li>
            
          
                    
                      
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href=/categories/
                  
                  
                  
                    id="categories"
                  >
                  <i class='fas fa-folder-open fa-fw'></i>Categories
                </a>
                
              </li>
            
          
                    
                      
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href=/tags/
                  
                  
                  
                    id="tags"
                  >
                  <i class='fas fa-tags fa-fw'></i>Tags
                </a>
                
              </li>
            
          
                    
                  </ul>
                
              </li>
            
          
            
              
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href=/webboard/
                  
                  
                  
                    id="webboard"
                  >
                  <i class='fas fa-comment-alt fa-fw'></i>Web Board
                </a>
                
              </li>
            
          
            
              
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href=/friends/
                  
                  
                  
                    id="friends"
                  >
                  <i class='fas fa-link fa-fw'></i>Friends
                </a>
                
              </li>
            
          
            
              
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" 
                  
                  
                  >
                  <i class='fas fa-info-circle fa-fw'></i>About
                </a>
                
                  <ul class="list-v">
                    
                      
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href=/aboutme/
                  
                  
                  
                    id="aboutme"
                  >
                  <i class='fas fa-address-card fa-fw'></i>About me
                </a>
                
              </li>
            
          
                    
                      
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href=/bloghistory/
                  
                  
                  
                    id="bloghistory"
                  >
                  <i class='fas fa-calendar fa-fw'></i>Blog History
                </a>
                
              </li>
            
          
                    
                  </ul>
                
              </li>
            
          
            
              
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" 
                  
                  
                  >
                  <i class='fas fa-ellipsis-h fa-fw'></i>More
                </a>
                
                  <ul class="list-v">
                    
                      
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href=/hiddenlist/
                  
                  
                  
                    id="hiddenlist"
                  >
                  <i class='fab fa-buffer fa-fw'></i>HiddenList
                </a>
                
              </li>
            
          
                    
                      
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href=/gallerypage/
                  
                  
                  
                    id="gallerypage"
                  >
                  <i class='fas fa-images fa-fw'></i>Gallery
                </a>
                
              </li>
            
          
                    
                      
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href=/donatepage/
                  
                  
                  
                    id="donatepage"
                  >
                  <i class='fas fa-heart fa-fw'></i>Donate
                </a>
                
              </li>
            
          
                    
                  </ul>
                
              </li>
            
          
            
          </ul>
        </li>
			</ul>
		</div>
	</div>
  </div>
</header>

  <div class="l_body">
    <div class="l_cover">
  
    
    
        <div class='cover-wrapper post search' style="display: none;">
          
            <div class='cover-backstretch'></div>
          
          <div class='cover-body'>
  <div class='top'>
    
      <img no-lazy class='logo' src='https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.3.12/img/magician1_for_favicon.png'/>
    
    
      <p class="title">Next Dream...</p>
    
    
      <p class="subtitle">This object has escaped into fantasy.</p>
    
  </div>
  <div class='bottom'>
    
      <div class="m_search">
        <form name="searchform" class="form u-search-form">
          <input type="text" class="input u-search-input" placeholder="Search in brynhild.online" />
          <i class="icon fas fa-search fa-fw"></i>
        </form>
      </div>
    
    <div class='menu navigation'>
      <div class='list-h'>
        
      </div>
    </div>
  </div>
</div>

          <div class="scroll-down" style="display: none;"><i class="fa fa-chevron-down scroll-down-effects"></i></div>
        </div>
    
  
  </div>
  
    <div class='safearea'>
      <div class='body-wrapper' id="pjax-container">
        
          <!--此文件用来存放一些不方便取值的变量--> 
<!--思路大概是将值藏到重加载的区域内--> 
 
 
 
<div id="pjax-data" style="display: none"> 
  <div id="pjax-ispage">true</div> 
  <div id="pjax-pageTitle">HongYanAsstHardware</div> 
  <div id="pjax-enable-cover">true</div> 
  <div id="pjax-comment-path"></div> 
  <div id="pjax-comment-placeholder"></div> 
</div> 
 
 
<script> 
  // 处理封面 此时 jquery 还没加载 
  if ("none" == "none") { // 移除封面 
    document.getElementsByClassName('cover-wrapper')[0].style.display = "none"; 
    document.getElementsByClassName('l_header', 'cover-wrapper')[0].classList.add("show"); 
  } else { 
    if ("none" == "half") { // 半屏 
      document.getElementsByClassName('cover-wrapper')[0].setAttribute('id', 'half'); 
      document.getElementsByClassName('scroll-down')[0].style.display = "none"; 
    } else if ("none" == "full") { // 全屏 
      document.getElementsByClassName('cover-wrapper')[0].setAttribute('id', 'full'); 
      document.getElementsByClassName('scroll-down')[0].style.display = ""; 
    } 
    document.getElementsByClassName('cover-wrapper')[0].style.display = ""; 
    document.getElementsByClassName('l_header', 'cover-wrapper')[0].classList.remove("show"); 
  } 
</script> 
 

        
        

<div class='l_main'>
  <article class="article post white-box reveal md shadow article-type-post" id="post" itemscope itemprop="blogPost">
  


  
  <div class="article-meta" id="top">
    
    
    
      <h1 class="title">
        HongYanAsstHardware
      </h1>
      <div class='new-meta-box'>
        
          
            
<div class='new-meta-item author'>
  <a class='author' href="/" rel="nofollow">
    <img no-lazy src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.3.13/img/magician1_for_favicon.png">
    <p>ELLIAS</p>
  </a>
</div>

          
        
          
            

          
        
          
            <div class="new-meta-item date">
  <a class='notlink'>
    <i class="fas fa-calendar-alt fa-fw" aria-hidden="true"></i>
    <p>Released at Nov 26, 2020</p>
  </a>
</div>

          
        
          
            
  <div class="new-meta-item browse leancloud">
    <a class='notlink'>
      
      <div id="lc-pv" data-title="HongYanAsstHardware" data-path="/HongYanAsstHard/">
        <i class="fas fa-eye fa-fw" aria-hidden="true"></i>
        <span id='number'><i class="fas fa-circle-notch fa-spin fa-fw" aria-hidden="true"></i></span>
        views
      </div>
    </a>
  </div>


          
        
      </div>
    
  </div>


  
  
  <blockquote>
<p>信息与通信工程导论项目 <code>HongYanAsst 骑行安全监控系统</code> Wiki</p>
</blockquote>
<img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.15.10/img/HYAH/gh_c7de51796504_3441.jpg" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.15.10/img/HYAH/gh_c7de51796504_3441.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" weidth="100" height = "100" alt="QRcode" align=center />

<a id="more"></a>

<h2 id="项目背景及用户分析"><a href="#项目背景及用户分析" class="headerlink" title="项目背景及用户分析"></a>项目背景及用户分析</h2><p>自行车在生活中随处可见，具有速度快、重量轻、节能环保、维护简单等优点。得益于人力车的性质，自行车兼具交通工具与运动器材的属性。它既是一种绿色环保的代步、出行方式；也可作为运动器材，进行多样的骑行训练与体育竞技。骑自行车锻炼，可亲近自然，愉悦身心，结交朋友，陶冶情操，更能增长见识，培养毅力，强身健体，预防疾病。近年来，随着智能运动终端的广泛普及，结合运动数据进行科学训练的模式，也正被愈发广泛地接受。</p>
<p>截至2019年，我国自行车社会保有量已近4亿辆、电动自行车近3亿辆，均位居世界第一。然而，自行车运动在我国的普及，前路依然漫长。推广力度的不足、相对高昂的器材价格与安全意识、健康意识的缺失等，都是阻碍更多普通大众接收自行车文化，加入骑友（骑行爱好者）行列的不利因素。</p>
<p>骑行运动本身由于速度快、技术要求高、时间长易于疲劳、路线一般开放等特点，其危险性可想而知。甚至仅仅是平时骑行通勤，道路上的机动车及电动车仍然会威胁到通勤安全。</p>
<p>年轻人，特别是大学生，一般具有体魄强健、追求刺激、乐于接受新鲜思想与事物的特点，十分适合作为自行车运动的普及者与首要普及对象。对普及者而言，正所谓“顺风而呼，声非加疾也，而闻者彰”，只有齐心协力，形成合力，持久发力，才能为自行车运动的普及与骑行活动的开展注入强大动力。成立自行车协会，组织骑行相关活动，是普及自行车文化较为经济、高效的方式之一。</p>
<p>时隔11载，2020年秋，在我校广大骑行爱好者的强烈要求与不懈努力之下，北郵鸿雁自行车协会（下简称“鸿雁车协”、“协会”）重新成立，正式成为认证社团。鸿雁车协推广自行车运动，为骑友提供交流平台，将骑行活动组织化、规范化，使自行车运动与健康意识在我校的普及迈出了基础却坚实的一步。</p>
<p>鸿雁车协的成立，对骑行爱好者意义重大，吸引了我校学生的广泛关注。迄今为止，协会已成功组织并顺利完成数次周边百公里级别骑行。2020年社团招新（百团大战）期间，关注协会者络绎不绝，覆盖各学院本科生、硕士生、博士生近300人；2020年社团嘉年华之夜，参与协会举办活动者260余人，现场排起长队，十分火爆。虽然成立时间尚短，活动举办尚少，但协会展现出的强劲发展势头，令鸿雁车协中心组与协会成员刮目相看。</p>
<p>然而，回顾我校自行车协会历史中断的十一年，却有太多需要弥补的损失。虽然我校骑友数载流离，车协事务百废待兴的混沌状态，已随着车协的成立与初步发展得到缓解，但不可否认的是，周边名校（如北大、央财、北航等）一直在争分夺秒，结合优势学科特色与社会影响力，建设专业性强，具有院校特色的自行车协会组织与良好的自行车文化氛围。相形之下，不论是组织、规模还是影响力，我邮车协都亟待发展。</p>
<p>提高学生健康意识，推动我校自行车运动事业发展，恰逢其运；利用所学知识与现有资源构建信息化平台，促进鸿雁车协的现代化、信息化进程，正当其时。鸿雁车协中心组部分成员联手志同道合者，组成团队，立志通过该项目的开发，为各高校车协的发展以及所有骑行爱好者的良好体验贡献力量。</p>
<h2 id="创意过程"><a href="#创意过程" class="headerlink" title="创意过程"></a>创意过程</h2><h3 id="创意分析过程"><a href="#创意分析过程" class="headerlink" title="创意分析过程"></a>创意分析过程</h3><p><img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.15.1/img/HYAH/YR6W32PQPT2CEEN7.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.15.1/img/HYAH/YR6W32PQPT2CEEN7.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="疯狂八分钟"></p>
<p><img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.15.1/img/HYAH/OZ3A6CWM1_JZ3C18Z5K.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.15.1/img/HYAH/OZ3A6CWM1_JZ3C18Z5K.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="用户共感图"></p>
<p><img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.15.1/img/HYAH/HZOU_EMJ8GCXJW8A1I8UA.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.15.1/img/HYAH/HZOU_EMJ8GCXJW8A1I8UA.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="用户痛点分析"></p>
<h3 id="项目目标"><a href="#项目目标" class="headerlink" title="项目目标"></a>项目目标</h3><p>本项目主要为鸿雁车协微信公众平台及微信小程序<code>HongYanAsst</code>，以及任何一位骑行爱好者及他们的亲友、任何一位骑行通勤者及他们的亲友开发端到端的、软硬结合的骑行安全监控系统。本项目的成果将包含以下几项核心功能：</p>
<ol>
<li>实时定位。实时获取设备位置信息及速度，并在微信小程序中显示。</li>
<li>事故侦测。由硬件设备判断是否发生事故，如发生事故则向指定手机号码发送短信告知。</li>
<li>高亮时刻。设备持有者可通过微信小程序在设备当前位置标点并上传图片，来和他的亲友共享。</li>
</ol>
<h3 id="Q-amp-A"><a href="#Q-amp-A" class="headerlink" title="Q&amp;A"></a>Q&amp;A</h3><p>这个板块为立项初期进行用户调研时热心用户提出的可行性建议中的典型代表.</p>
<p>热心用户的提问对我们帮助很大, 能更清楚地了解用户担心什么, 让考虑更周全.</p>
<ul>
<li>Q: 为什么不使用手机作为<code>GPS</code>信源, 做小程序端到端系统?</li>
<li>A: 我们测试过微信小程序获取并发送<code>GPS</code>定位在手机后台运行的稳定性, 在<code>Samsung S20</code>上一小时稳定性约为<code>76%</code>, <code>HUAWEI P30</code>约为<code>65%</code>, 故不采用这种不稳妥的方式. 而且手机作为出门在外唯一的实时通信工具, 让手机有额外的电源损耗可能不是明智之举.<br></li>
<li>Q: 为什么对产品重量和气动效果重视程度较低?</li>
<li>A: 轻量化和气动外形研发时间长, 成本高, 研发团队在短时间内可能无法做出很好的解决方案, 短期内只打算对核心功能做建设及优化. 况且我们的用户定位更倾向于一般的骑行爱好者及通勤者, 竞赛型用户究竟是少数. 另外, 我们的项目是开源的, 用户完全在符合协议要求的前提下使用更好的材料、定制更气动的外形.<br></li>
<li>Q: 有考虑过使用<code>ESP8266</code>模块使用<code>WiFi</code>作为网络接入解决方案吗?</li>
<li>A: 有考虑过. <code>SIM</code>系列硬件对电源功率的要求比较高, 功耗也比较高, 也很占体积. 使用<code>ESP8266</code>连接<code>WiFi</code>虽然会消耗手机电源, 但是现在大部分的手机都具备移动热点功率优化系统, 人家<code>大Pro</code>做的终究是要比我们好. 所以如果<code>SIM</code>策略不符合现有条件, 我们会考虑用<code>ESP8266</code>连接移动热点来解决联网问题.<br></li>
<li>Q: 看到你们为了调试做了很多, 软件和硬件上的都有.</li>
<li>A: 确实. 我们很重视调试体验. 我们坚信良好的调试环境可以极大地提高调试效率.</li>
</ul>
<h2 id="初步原理规划"><a href="#初步原理规划" class="headerlink" title="初步原理规划"></a>初步原理规划</h2><p><img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.15.1/img/HYAH/5B3EE6LF5D6EUR3YRM60.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.15.1/img/HYAH/5B3EE6LF5D6EUR3YRM60.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="总体规划框图"></p>
<p><img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.15.1/img/HYAH/WeChat-miniprogram.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.15.1/img/HYAH/WeChat-miniprogram.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="微信小程序规划框图"></p>
<p><img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.15.1/img/HYAH/%E7%A1%AC%E4%BB%B6%E5%8E%9F%E7%90%86%E5%9B%BE2.2.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.15.1/img/HYAH/%E7%A1%AC%E4%BB%B6%E5%8E%9F%E7%90%86%E5%9B%BE2.2.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="硬件规划框图"></p>
<p><img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/HYAH/hard2.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/HYAH/hard2.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="硬件规划框图(大作业最终版)"></p>
<h2 id="设备"><a href="#设备" class="headerlink" title="设备"></a>设备</h2><h3 id="设备列表"><a href="#设备列表" class="headerlink" title="设备列表"></a>设备列表</h3><table>
<thead>
<tr>
<th>模块</th>
<th>数量</th>
<th>功能</th>
</tr>
</thead>
<tbody><tr>
<td><font color=green>Arduino MEGA 2560</font></td>
<td>1</td>
<td>核心板</td>
</tr>
<tr>
<td>NI-MH AA 5600mAh 4.8V 电池阵列</td>
<td>2</td>
<td>供电</td>
</tr>
<tr>
<td><font color=green>SIM800C</font></td>
<td>1</td>
<td>移动网络接入</td>
</tr>
<tr>
<td>NEO-7N</td>
<td>1</td>
<td>获取GPS数据</td>
</tr>
<tr>
<td><font color=green>MPU6050</font></td>
<td>1</td>
<td>获取加速度及计算偏角</td>
</tr>
<tr>
<td><font color=red>ESP8266</font></td>
<td>1</td>
<td><strong>[调试]</strong> 数据传输调试</td>
</tr>
<tr>
<td><font color=red>LCD1602</font></td>
<td>1</td>
<td><strong>[调试]</strong> 数据展示</td>
</tr>
<tr>
<td><font color=red>CHQ1838</font></td>
<td>1</td>
<td><strong>[调试]</strong> 读取红外信息</td>
</tr>
<tr>
<td>Li14500</td>
<td>1</td>
<td><strong>[调试]</strong> 供电</td>
</tr>
<tr>
<td><font color=red>Li18650</font></td>
<td>2</td>
<td><strong>[调试]</strong> 供电</td>
</tr>
</tbody></table>
<blockquote>
<p>绿色表示核心组件, 红色表示已弃用.</p>
</blockquote>
<h3 id="硬件组装"><a href="#硬件组装" class="headerlink" title="硬件组装"></a>硬件组装</h3><div class="timenode"><div class="meta"><p><p>V0.0 2020/11/24</p>
</p></div><div class="body"><h4 id="原型机-HYAsst-THE-ORIGIN"><a href="#原型机-HYAsst-THE-ORIGIN" class="headerlink" title="原型机: HYAsst THE ORIGIN"></a>原型机: <code>HYAsst THE ORIGIN</code></h4><details ><summary> <p>Photos</p> </summary>              <div class='content'>              <p><img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.15.1/img/HYAH/20201124_224903.jpg" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.15.1/img/HYAH/20201124_224903.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="THE ORIGIN"><br><img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.15.1/img/HYAH/20201124_224911.jpg" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.15.1/img/HYAH/20201124_224911.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="THE ORIGIN"><br><img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.15.1/img/HYAH/20201124_224920.jpg" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.15.1/img/HYAH/20201124_224920.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="THE ORIGIN"></p>              </div>            </details><details ><summary> <p>迭代说明</p> </summary>              <div class='content'>              <p>原型机, 调试用, 有丰富的数据显示, 初步实现上述所有功能.</p>              </div>            </details></div></div>

<div class="timenode"><div class="meta"><p><p>v0.1 2020/11/27</p>
</p></div><div class="body"><h4 id="初代机-ASKR-YGGDRASILLS"><a href="#初代机-ASKR-YGGDRASILLS" class="headerlink" title="初代机: ASKR YGGDRASILLS"></a>初代机: <code>ASKR YGGDRASILLS</code></h4><details ><summary> <p>Photos</p> </summary>              <div class='content'>              <p><img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.15.1/img/HYAH/1606476417218.jpg" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.15.1/img/HYAH/1606476417218.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="ASKR YGGDRASILLS"><br><img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.15.1/img/HYAH/1606476459137.jpg" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.15.1/img/HYAH/1606476459137.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="ASKR YGGDRASILLS"></p>              </div>            </details><details ><summary> <p>迭代说明</p> </summary>              <div class='content'>              <ol><li>取消LCD数据展示及调试中断, 使用<code>LED</code>灯作为交互接口.</li><li>彻底弃用<code>ESP8266</code>, 改用<code>SIM800C</code>接入网络.</li><li>取消睡眠功能, 采用动态电源规划.</li></ol>              </div>            </details></div></div>

<div class="timenode"><div class="meta"><p><p>v1.0 2020/11/29</p>
</p></div><div class="body"><h4 id="二号机-SORYU-KYOKO-ZEPPELIN"><a href="#二号机-SORYU-KYOKO-ZEPPELIN" class="headerlink" title="二号机: SORYU KYOKO ZEPPELIN"></a>二号机: <code>SORYU KYOKO ZEPPELIN</code></h4><details ><summary> <p>Photos</p> </summary>              <div class='content'>              <p><img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.15.6/img/HYAH/20201129_223828.jpg" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.15.6/img/HYAH/20201129_223828.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="SORYU KYOKO ZEPPELIN"><br><img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.15.6/img/HYAH/20201129_223839.jpg" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.15.6/img/HYAH/20201129_223839.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="SORYU KYOKO ZEPPELIN"><br><img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.15.6/img/HYAH/20201129_223927.jpg" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.15.6/img/HYAH/20201129_223927.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="SORYU KYOKO ZEPPELIN"></p>              </div>            </details><details ><summary> <p>迭代说明</p> </summary>              <div class='content'>              <ol><li>舍弃面包板, 使用主板铜柱固定各功能模块, 提升便携性.</li><li>暂时放弃<code>LED</code>交互接口及电容组.</li><li>更好的走线, 更坚固的框架, 更友好的外形, 设备便携性进一步提升.</li></ol>              </div>            </details></div></div>

<div class="timenode"><div class="meta"><p><p>v1.1 2020/12/02</p>
</p></div><div class="body"><h4 id="二号机·改-SORYU-ASUKA-RANGURE"><a href="#二号机·改-SORYU-ASUKA-RANGURE" class="headerlink" title="二号机·改: SORYU ASUKA RANGURE"></a>二号机·改: <code>SORYU ASUKA RANGURE</code></h4><details ><summary> <p>Photos</p> </summary>              <div class='content'>              <p><img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.15.7/img/HYAH/20201202_125722.jpg" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.15.7/img/HYAH/20201202_125722.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="SORYU ASUKA RANGURE"><br><img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.15.7/img/HYAH/20201202_125735.jpg" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.15.7/img/HYAH/20201202_125735.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="SORYU ASUKA RANGURE"></p>              </div>            </details><details ><summary> <p>迭代说明</p> </summary>              <div class='content'>              <ol><li>重新启用<code>LED</code>交互接口及电容组, 将其整合到一张板上(为下一个版本做准备).</li><li><code>SIM800C</code>弃用胶棒天线, 换用弹簧天线, 进一步提升便携性.</li></ol>              </div>            </details></div></div>

<div class="timenode"><div class="meta"><p><p>v2.0 2020/12/05</p>
</p></div><div class="body"><h4 id="三代目-RAMIEL-OCTAHEDRON"><a href="#三代目-RAMIEL-OCTAHEDRON" class="headerlink" title="三代目: RAMIEL OCTAHEDRON"></a>三代目: <code>RAMIEL OCTAHEDRON</code></h4><details ><summary> <p>Photos</p> </summary>              <div class='content'>              <p><img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/HYAH/20201205_230927.jpg" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/HYAH/20201205_230927.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="RAMIEL OCTAHEDRON"><br><img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/HYAH/20201205_230945.jpg" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/HYAH/20201205_230945.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="RAMIEL OCTAHEDRON"><br><img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/HYAH/20201205_230957.jpg" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/HYAH/20201205_230957.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="RAMIEL OCTAHEDRON"></p>              </div>            </details><details ><summary> <p>迭代说明</p> </summary>              <div class='content'>              <ol><li>重新制作灯板, 增加线路整理功能, 并整合到设备上部.</li><li>启用<code>NI-MH AA 5600mAh 4.8V</code>电池阵列并置于设备底部, 理论续航延长至<code>23</code>小时.</li><li>优化内存占用, 将静态内容优先存储至<code>Flash</code>.</li><li>事故侦测倾角维护时间增长至<code>150</code>个算法周期.</li></ol>              </div>            </details></div></div>

<div class="timenode"><div class="meta"><p><p>v2.1 2020/12/07</p>
</p></div><div class="body"><h4 id="导论课大作业成果-RAMIEL-FINAL"><a href="#导论课大作业成果-RAMIEL-FINAL" class="headerlink" title="导论课大作业成果: RAMIEL FINAL"></a>导论课大作业成果: <code>RAMIEL FINAL</code></h4><details ><summary> <p>Photos</p> </summary>              <div class='content'>              <p><img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/HYAH/20201207_205108.jpg" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/HYAH/20201207_205108.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="RAMIEL FINAL"><br><img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/HYAH/20201207_205129.jpg" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/HYAH/20201207_205129.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="RAMIEL FINAL"><br><img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/HYAH/20201207_205450.jpg" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/HYAH/20201207_205450.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="RAMIEL FINAL"></p>              </div>            </details><details ><summary> <p>迭代说明</p> </summary>              <div class='content'>              <ol><li>整理了排线, 提升便携性.</li><li>加固固定部分, 提升便携性.</li><li>优化灯板电气性能, 重写<code>LED</code>灯控代码, 延长续航.</li></ol>              </div>            </details></div></div>

<h4 id="我也不知道到底应该叫什么的洞洞板展示"><a href="#我也不知道到底应该叫什么的洞洞板展示" class="headerlink" title="我也不知道到底应该叫什么的洞洞板展示"></a><code>我也不知道到底应该叫什么的洞洞板</code>展示</h4><p>因为尺寸不对拿胶水粘的, 但是这胶水的强度真的超乎我的想象. 本来想给扒下来拍背面的, 结果愣是没整下来. 我太菜了.</p>
<details ><summary> <p>Photos</p> </summary>
              <div class='content'>
              <p><img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@12.15.19/img/HYAH/20201212_164751.jpg" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@12.15.19/img/HYAH/20201212_164751.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="上面效果图"><br><img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@12.15.19/img/HYAH/20201212_164847.jpg" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@12.15.19/img/HYAH/20201212_164847.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="侧面(背面?) 1"><br><img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@12.15.19/img/HYAH/20201212_164915.jpg" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@12.15.19/img/HYAH/20201212_164915.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="侧面(背面?) 2"></p>
              </div>
            </details>

<h2 id="How-to-use"><a href="#How-to-use" class="headerlink" title="How to use"></a>How to use</h2><h3 id="软件设定"><a href="#软件设定" class="headerlink" title="软件设定"></a>软件设定</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ACCIDENT_ACCE 2          <span class="comment">// 加速度阈值, 以G为单位</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ACCIDENT_ANGLE 90        <span class="comment">// 偏差角阈值, 以度为单位</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ACCIDENT_ALERT_SPEED 25  <span class="comment">// 速度阈值,   以km/h为单位</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> DEVICE_ID <span class="meta-string">&quot;xxxx&quot;</span>         <span class="comment">// 设备ID</span></span></span><br><span class="line"><span class="keyword">const</span> String APIKey = <span class="string">&quot;xxxx&quot;</span>;    <span class="comment">// 设备api-key</span></span><br><span class="line"><span class="keyword">const</span> String TEL_NUM = <span class="string">&quot;xxxx&quot;</span>;   <span class="comment">// 事故报警目标电话号</span></span><br></pre></td></tr></table></figure>

<h3 id="指示灯信息"><a href="#指示灯信息" class="headerlink" title="指示灯信息"></a>指示灯信息</h3><p>本项目为产品体积 质量以及实际考虑, 使用指示灯显示的方式进行交互.</p>
<h4 id="main-board"><a href="#main-board" class="headerlink" title="main board"></a>main board</h4><table>
<thead>
<tr>
<th align="center">status</th>
<th align="center">green LED</th>
<th align="center">yellow LED</th>
<th align="center">RGB</th>
</tr>
</thead>
<tbody><tr>
<td align="center">1</td>
<td align="center"><code>Arduino</code> power on</td>
<td align="center">device power on</td>
<td align="center">-</td>
</tr>
<tr>
<td align="center">0</td>
<td align="center"><code>Arduino</code> no power</td>
<td align="center">device no power</td>
<td align="center">-</td>
</tr>
<tr>
<td align="center">White</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">initializing</td>
</tr>
<tr>
<td align="center">Blue</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">data fetching</td>
</tr>
<tr>
<td align="center">Green</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">data updating</td>
</tr>
<tr>
<td align="center">Red</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">AccidentReport triggered</td>
</tr>
</tbody></table>
<h4 id="SIM800C"><a href="#SIM800C" class="headerlink" title="SIM800C"></a>SIM800C</h4><table>
<thead>
<tr>
<th align="center">status</th>
<th align="center">PWR</th>
<th align="center">NET</th>
</tr>
</thead>
<tbody><tr>
<td align="center">0</td>
<td align="center">no power</td>
<td align="center">no power</td>
</tr>
<tr>
<td align="center">1</td>
<td align="center">power on</td>
<td align="center">-</td>
</tr>
<tr>
<td align="center">blink (1 per 1s)</td>
<td align="center">-</td>
<td align="center">searching network</td>
</tr>
<tr>
<td align="center">blink (1 per 3s)</td>
<td align="center">-</td>
<td align="center">network connection OK</td>
</tr>
<tr>
<td align="center">blink (1 per 0.5s)</td>
<td align="center">-</td>
<td align="center">TCP connection established</td>
</tr>
</tbody></table>
<h4 id="GPS"><a href="#GPS" class="headerlink" title="GPS"></a>GPS</h4><table>
<thead>
<tr>
<th align="center">status</th>
<th align="center">PPS</th>
</tr>
</thead>
<tbody><tr>
<td align="center">0</td>
<td align="center">no power</td>
</tr>
<tr>
<td align="center">1</td>
<td align="center">searching for satellite</td>
</tr>
<tr>
<td align="center">blink</td>
<td align="center">PPS</td>
</tr>
</tbody></table>
<h4 id="MPU6050"><a href="#MPU6050" class="headerlink" title="MPU6050"></a>MPU6050</h4><table>
<thead>
<tr>
<th align="center">status</th>
<th align="center">PWR</th>
</tr>
</thead>
<tbody><tr>
<td align="center">0</td>
<td align="center">no power</td>
</tr>
<tr>
<td align="center">1</td>
<td align="center">power on</td>
</tr>
</tbody></table>
<h2 id="功能实现"><a href="#功能实现" class="headerlink" title="功能实现"></a>功能实现</h2><h3 id="硬件"><a href="#硬件" class="headerlink" title="硬件"></a>硬件</h3><h4 id="调试工具"><a href="#调试工具" class="headerlink" title="调试工具"></a>调试工具</h4><p>为了进行<code>SIM800C</code>调试而简单写的基于<code>Arduino</code>的串口调试工具. 不用<code>USB</code>转串口也可以进行串口调试.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;Arduino.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> mySerial Serial2</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">setup</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  Serial2.begin(<span class="number">115200</span>);</span><br><span class="line">  Serial.begin(<span class="number">115200</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">loop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (mySerial.available()) Serial.write(mySerial.read());</span><br><span class="line">  <span class="keyword">if</span> (Serial.available()) mySerial.write(Serial.read());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Arduino-多线程"><a href="#Arduino-多线程" class="headerlink" title="Arduino 多线程"></a>Arduino 多线程</h4><h5 id="Metro-Timer"><a href="#Metro-Timer" class="headerlink" title="Metro Timer"></a>Metro Timer</h5><p>使用计时器库 <a target="_blank" rel="noopener" href="https://github.com/thomasfredericks/Metro-Arduino-Wiring">Metro</a> 模拟多线程操作. 详情见代码中<code>loop()</code>函数.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;Metro.h&gt;</span></span></span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Metro dataUpdate      = Metro(<span class="number">5000</span>);</span><br><span class="line">Metro dataFetch       = Metro(<span class="number">1000</span>);</span><br><span class="line">Metro accidentMonitor = Metro(<span class="number">100</span>);</span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (dataFetch.check())  getGpsData();</span><br><span class="line"><span class="keyword">if</span> (dataUpdate.check()) dataUpd();</span><br></pre></td></tr></table></figure>

<h5 id="SCoop"><a href="#SCoop" class="headerlink" title="SCoop"></a>SCoop</h5><p><code>timer0_overflow_count</code>未定义问题:</p>
<p>新版本的<code>ArduinoIDE</code>在编译的过程中不再识别<code>timer0_overflow_count</code>, 即使它前面有<code>extern</code>语句. 这使得<code>timer0_overflow_count</code>在全局作用域中不可见. 但是在旧版的<code>ArduinoIDE</code>中可以正常工作. <code>SCoop.cpp</code>中原文如下:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">extern</span> <span class="keyword">volatile</span> <span class="keyword">unsigned</span> <span class="keyword">long</span> timer0_overflow_count; <span class="comment">// use this variable which is incremented at each overflow</span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">micros_t</span> <span class="title">SCoopMicros16</span><span class="params">(<span class="keyword">void</span>)</span> __<span class="title">attribute__</span><span class="params">((always_inline))</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">micros_t</span> <span class="title">SCoopMicros16</span><span class="params">(<span class="keyword">void</span>)</span> <span class="comment">// same as standrad PJRC micros, but in 16 bits and with inlining</span></span></span><br><span class="line"><span class="function"></span>&#123;	<span class="keyword">register</span> <span class="keyword">micros_t</span> out ;</span><br><span class="line">	<span class="function"><span class="keyword">asm</span> <span class="title">volatile</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">		<span class="string">&quot;in	__tmp_reg__, __SREG__&quot;</span>			<span class="string">&quot;\n\t&quot;</span></span></span></span><br><span class="line"><span class="function"><span class="params">		<span class="string">&quot;cli&quot;</span>								<span class="string">&quot;\n\t&quot;</span></span></span></span><br><span class="line"><span class="function"><span class="params">		<span class="string">&quot;in	%A0, %2&quot;</span>						<span class="string">&quot;\n\t&quot;</span></span></span></span><br><span class="line"><span class="function"><span class="params">		<span class="string">&quot;in	__zero_reg__, %3&quot;</span>				<span class="string">&quot;\n\t&quot;</span></span></span></span><br><span class="line"><span class="function"><span class="params">		<span class="string">&quot;lds	%B0, timer0_overflow_count&quot;</span>	<span class="string">&quot;\n\t&quot;</span></span></span></span><br><span class="line"><span class="function"><span class="params">		<span class="string">&quot;out	__SREG__, __tmp_reg__&quot;</span>		<span class="string">&quot;\n\t&quot;</span></span></span></span><br><span class="line"><span class="function"><span class="params">		<span class="string">&quot;sbrs	__zero_reg__, %4&quot;</span>			<span class="string">&quot;\n\t&quot;</span></span></span></span><br><span class="line"><span class="function"><span class="params">		<span class="string">&quot;rjmp	L_%=_skip&quot;</span>					<span class="string">&quot;\n\t&quot;</span></span></span></span><br><span class="line"><span class="function"><span class="params">		<span class="string">&quot;cpi	%A0, 255&quot;</span>					<span class="string">&quot;\n\t&quot;</span></span></span></span><br><span class="line"><span class="function"><span class="params">		<span class="string">&quot;breq	L_%=_skip&quot;</span>					<span class="string">&quot;\n\t&quot;</span></span></span></span><br><span class="line"><span class="function"><span class="params">#<span class="keyword">if</span> F_CPU == <span class="number">16000000L</span> </span></span></span><br><span class="line"><span class="function"><span class="params">		<span class="string">&quot;subi	%B0, 1&quot;</span>						<span class="string">&quot;\n\t&quot;</span></span></span></span><br><span class="line"><span class="function"><span class="params">#elif F_CPU == <span class="number">8000000L</span> </span></span></span><br><span class="line"><span class="function"><span class="params">		<span class="string">&quot;subi	%B0, 2&quot;</span>						<span class="string">&quot;\n\t&quot;</span></span></span></span><br><span class="line"><span class="function"><span class="params">#endif		</span></span></span><br><span class="line"><span class="function"><span class="params">	<span class="string">&quot;L_%=_skip:&quot;</span>							<span class="string">&quot;\n\t&quot;</span></span></span></span><br><span class="line"><span class="function"><span class="params">		<span class="string">&quot;clr	__zero_reg__&quot;</span>				<span class="string">&quot;\n\t&quot;</span></span></span></span><br><span class="line"><span class="function"><span class="params">		<span class="string">&quot;clr	__tmp_reg__&quot;</span>				<span class="string">&quot;\n\t&quot;</span></span></span></span><br><span class="line"><span class="function"><span class="params">#<span class="keyword">if</span> F_CPU == <span class="number">16000000L</span> || F_CPU == <span class="number">8000000L</span></span></span></span><br><span class="line"><span class="function"><span class="params">		<span class="string">&quot;lsl	%B0&quot;</span>						<span class="string">&quot;\n\t&quot;</span></span></span></span><br><span class="line"><span class="function"><span class="params">		<span class="string">&quot;lsl	%B0&quot;</span>						<span class="string">&quot;\n\t&quot;</span></span></span></span><br><span class="line"><span class="function"><span class="params">		<span class="string">&quot;lsl	%A0&quot;</span>						<span class="string">&quot;\n\t&quot;</span></span></span></span><br><span class="line"><span class="function"><span class="params">		<span class="string">&quot;rol	__tmp_reg__&quot;</span>				<span class="string">&quot;\n\t&quot;</span></span></span></span><br><span class="line"><span class="function"><span class="params">		<span class="string">&quot;lsl	%A0&quot;</span>						<span class="string">&quot;\n\t&quot;</span></span></span></span><br><span class="line"><span class="function"><span class="params">		<span class="string">&quot;rol	__tmp_reg__&quot;</span>				<span class="string">&quot;\n\t&quot;</span></span></span></span><br><span class="line"><span class="function"><span class="params">#<span class="keyword">if</span> F_CPU == <span class="number">8000000L</span> </span></span></span><br><span class="line"><span class="function"><span class="params">		<span class="string">&quot;lsl	%B0&quot;</span>						<span class="string">&quot;\n\t&quot;</span></span></span></span><br><span class="line"><span class="function"><span class="params">		<span class="string">&quot;lsl	%A0&quot;</span>						<span class="string">&quot;\n\t&quot;</span></span></span></span><br><span class="line"><span class="function"><span class="params">		<span class="string">&quot;rol	__tmp_reg__&quot;</span>				<span class="string">&quot;\n\t&quot;</span></span></span></span><br><span class="line"><span class="function"><span class="params">#endif</span></span></span><br><span class="line"><span class="function"><span class="params">		<span class="string">&quot;or	%B0, __tmp_reg__&quot;</span>				<span class="string">&quot;\n\t&quot;</span></span></span></span><br><span class="line"><span class="function"><span class="params">#endif</span></span></span><br><span class="line"><span class="function"><span class="params">		: <span class="string">&quot;=r&quot;</span> (out)</span></span></span><br><span class="line"><span class="function"><span class="params">		: <span class="string">&quot;M&quot;</span> (TIMER0_MICROS_INC),</span></span></span><br><span class="line"><span class="function"><span class="params">		  <span class="string">&quot;I&quot;</span> (_SFR_IO_ADDR(TCNT0)),</span></span></span><br><span class="line"><span class="function"><span class="params">		  <span class="string">&quot;I&quot;</span> (_SFR_IO_ADDR(TIFR0)),</span></span></span><br><span class="line"><span class="function"><span class="params">		  <span class="string">&quot;I&quot;</span> (TOV0)</span></span></span><br><span class="line"><span class="function"><span class="params">		: <span class="string">&quot;r0&quot;</span> )</span></span>; <span class="keyword">return</span> out; &#125;</span><br></pre></td></tr></table></figure>

<p>在<code>timer0_overflow_count</code>的定义后加入</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">unsigned</span> <span class="keyword">long</span> timer0_overflow_count_available_container = timer0_overflow_count;</span><br></pre></td></tr></table></figure>

<p>即可.</p>
<h4 id="Kalman-Filter"><a href="#Kalman-Filter" class="headerlink" title="Kalman Filter"></a>Kalman Filter</h4><p>使用积分, 对角速度及加速度进行操作计算倾角, 并使陀螺仪倾角平滑化.</p>
<p>reference:</p>
<p><a target="_blank" rel="noopener" href="http://bilgin.esme.org/BitsAndBytes/KalmanFilterforDummies">KalmanFilterforDummies</a></p>
<p><a target="_blank" rel="noopener" href="https://www.intechopen.com/books/introduction-and-implementations-of-the-kalman-filter/introduction-to-kalman-filter-and-its-applications">Introduction to kalman filter and its applications</a></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">getAcce</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">long</span> now = millis();</span><br><span class="line">  dt = (now - lastTime) / <span class="number">1000.0</span>;</span><br><span class="line">  lastTime = now;</span><br><span class="line"></span><br><span class="line">  accelgyro.getMotion6(&amp;ax, &amp;ay, &amp;az, &amp;gx, &amp;gy, &amp;gz);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">double</span> accx = ax / AcceRatio, accy = ay / AcceRatio, accz = az / AcceRatio;</span><br><span class="line"></span><br><span class="line">  aax = <span class="built_in">atan</span>(accy / accz) * (<span class="number">-180</span>) / pi;</span><br><span class="line">  aay = <span class="built_in">atan</span>(accx / accz) * <span class="number">180</span> / pi;</span><br><span class="line">  aaz = <span class="built_in">atan</span>(accz / accy) * <span class="number">180</span> / pi;</span><br><span class="line"></span><br><span class="line">  aax_sum = aay_sum = aaz_sum = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">register</span> <span class="keyword">int</span> i=<span class="number">1</span>; i ^ n_sample; ++ i) &#123;</span><br><span class="line">    aaxs[i<span class="number">-1</span>] = aaxs[i], aax_sum += aaxs[i] * i;</span><br><span class="line">    aays[i<span class="number">-1</span>] = aays[i], aay_sum += aays[i] * i;</span><br><span class="line">    aazs[i<span class="number">-1</span>] = aazs[i], aaz_sum += aazs[i] * i;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  aaxs[n_sample<span class="number">-1</span>] = aax, aax_sum += aax * n_sample, aax = (aax_sum / (<span class="number">11</span> * n_sample / <span class="number">2.0</span>)) * <span class="number">9</span> / <span class="number">7.0</span>;</span><br><span class="line">  aays[n_sample<span class="number">-1</span>] = aay, aay_sum += aay * n_sample, aay = (aay_sum / (<span class="number">11</span> * n_sample / <span class="number">2.0</span>)) * <span class="number">9</span> / <span class="number">7.0</span>;</span><br><span class="line">  aazs[n_sample<span class="number">-1</span>] = aaz, aaz_sum += aaz * n_sample, aaz = (aaz_sum / (<span class="number">11</span> * n_sample / <span class="number">2.0</span>)) * <span class="number">9</span> / <span class="number">7.0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">double</span> gyrox = -(gx - gxo) / GyroRatio * dt;</span><br><span class="line">  <span class="keyword">double</span> gyroy = -(gy - gyo) / GyroRatio * dt;</span><br><span class="line">  <span class="keyword">double</span> gyroz = -(gz - gzo) / GyroRatio * dt;</span><br><span class="line">  agx += gyrox, agy += gyroy, agz += gyroz;</span><br><span class="line"></span><br><span class="line">  Sx = Rx = Sy = Ry = Sz = Rz = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i ^ <span class="number">10</span>; ++ i) &#123;</span><br><span class="line">    a_x[i - <span class="number">1</span>] = a_x[i], Sx += a_x[i];</span><br><span class="line">    a_y[i - <span class="number">1</span>] = a_y[i], Sy += a_y[i];</span><br><span class="line">    a_z[i - <span class="number">1</span>] = a_z[i], Sz += a_z[i];</span><br><span class="line">  &#125; a_x[<span class="number">9</span>] = aax, Sx += aax, Sx /= <span class="number">10</span>, a_y[<span class="number">9</span>] = aay, Sy += aay, Sy /= <span class="number">10</span>, a_z[<span class="number">9</span>] = aaz, Sz += aaz, Sz /= <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">register</span> <span class="keyword">int</span> i=<span class="number">0</span>; i^<span class="number">10</span>; ++ i) Rx += sq(a_x[i] - Sx), Ry += sq(a_y[i] - Sy), Rz += sq(a_z[i] - Sz);</span><br><span class="line"></span><br><span class="line">  Rx = Rx / <span class="number">9</span>, Ry = Ry / <span class="number">9</span>, Rz = Rz / <span class="number">9</span>;</span><br><span class="line"></span><br><span class="line">  Px = Px + <span class="number">0.0025</span>, Kx = Px / (Px + Rx), agx = agx + Kx * (aax - agx), Px = (<span class="number">1</span> - Kx) * Px;</span><br><span class="line">  Py = Py + <span class="number">0.0025</span>, Ky = Py / (Py + Ry), agy = agy + Ky * (aay - agy), Py = (<span class="number">1</span> - Ky) * Py;</span><br><span class="line">  Pz = Pz + <span class="number">0.0025</span>, Kz = Pz / (Pz + Rz), agz = agz + Kz * (aaz - agz), Pz = (<span class="number">1</span> - Kz) * Pz;</span><br><span class="line"></span><br><span class="line">  <span class="meta">#<span class="meta-keyword">ifdef</span> ACCELGYRO_SERIAL_OUTPUT</span></span><br><span class="line"></span><br><span class="line">  Serial.print(agx); Serial.print(<span class="string">&quot;,&quot;</span>); Serial.print(agy); Serial.print(<span class="string">&quot;,&quot;</span>); Serial.print(agz);</span><br><span class="line">  Serial.println();</span><br><span class="line"></span><br><span class="line">  <span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="SIM800C-供电问题"><a href="#SIM800C-供电问题" class="headerlink" title="SIM800C 供电问题"></a>SIM800C 供电问题</h4><p>众所周知, <code>SIM800C</code>功耗较大, 正常工况功率可以高达$5W$, 搜索网络过程中更是需要$10W$的高功率, 而<code>Arduino</code>的$5V$引脚是提供不了$5V2A$的高功率的. 为了解决这个问题我们使用<code>Li14500</code>电池对电路直接加电, 同时给包括<code>Arduino</code>板在内的所有模块供电. 为了进一步提高电路稳定性, 我们还在电路中加入了四颗当初玩粉尘传感器玩剩下的$220UF$电解电容, 来提升电路瞬间放电能力.</p>
<details ><summary> <p>Photos</p> </summary>
              <div class='content'>
              <p><img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.15.3/img/HYAH/1606272871126.jpg" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.15.3/img/HYAH/1606272871126.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="220UF50V电解电容"><br><img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.15.3/img/HYAH/1606272565927.jpg" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.15.3/img/HYAH/1606272565927.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="硬件连接"></p>
              </div>
            </details>
<h4 id="SIM800C发送HTTP报文"><a href="#SIM800C发送HTTP报文" class="headerlink" title="SIM800C发送HTTP报文"></a>SIM800C发送HTTP报文</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">dataUpd</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">  SIM.println(<span class="string">&quot;AT\r&quot;</span>); delay(<span class="number">100</span>);</span><br><span class="line">  SIM.println(<span class="string">&quot;AT+CGDCONT=1,\&quot;IP\&quot;,\&quot;CMNET\&quot;\r&quot;</span>); delay(<span class="number">100</span>);</span><br><span class="line">  SIM.println(<span class="string">&quot;AT+CGATT=1&quot;</span>); delay(<span class="number">100</span>);</span><br><span class="line">  SIM.println(<span class="string">&quot;AT+CIPCSGP=1,\&quot;CMNET\&quot;\r&quot;</span>); delay(<span class="number">100</span>);</span><br><span class="line">  SIM.println(<span class="string">&quot;AT+CLPORT=\&quot;TCP\&quot;,\&quot;2000\&quot;\r&quot;</span>); delay(<span class="number">100</span>);</span><br><span class="line">  SIM.println(<span class="string">&quot;AT+CIPSTART=\&quot;TCP\&quot;,\&quot;183.230.40.33\&quot;,\&quot;80\&quot;\r&quot;</span>);</span><br><span class="line">  delay(<span class="number">100</span>); SIM.println(<span class="string">&quot;AT+CIPSEND&quot;</span>); delay(<span class="number">100</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">char</span> buf[<span class="number">10</span>];</span><br><span class="line">  String jsonToSend = <span class="string">&quot;&#123;\&quot;Logitude\&quot;:&quot;</span>;</span><br><span class="line">  dtostrf(Logi, <span class="number">1</span>, <span class="number">6</span>, buf);</span><br><span class="line">  jsonToSend += <span class="string">&quot;\&quot;&quot;</span> + String(buf) + <span class="string">&quot;\&quot;&quot;</span>;</span><br><span class="line">  jsonToSend += <span class="string">&quot;,\&quot;Latitude\&quot;:&quot;</span>;</span><br><span class="line">  dtostrf(Lati, <span class="number">1</span>, <span class="number">6</span>, buf);</span><br><span class="line">  jsonToSend += <span class="string">&quot;\&quot;&quot;</span> + String(buf) + <span class="string">&quot;\&quot;&quot;</span>;</span><br><span class="line">  jsonToSend += <span class="string">&quot;,\&quot;Altitude\&quot;:&quot;</span>;</span><br><span class="line">  dtostrf(Alti, <span class="number">1</span>, <span class="number">6</span>, buf);</span><br><span class="line">  jsonToSend += <span class="string">&quot;\&quot;&quot;</span> + String(buf) + <span class="string">&quot;\&quot;&quot;</span>;</span><br><span class="line">  jsonToSend += <span class="string">&quot;,\&quot;Speed\&quot;:&quot;</span>;</span><br><span class="line">  dtostrf(Skmph, <span class="number">1</span>, <span class="number">2</span>, buf);</span><br><span class="line">  jsonToSend += <span class="string">&quot;\&quot;&quot;</span> + String(buf) + <span class="string">&quot;\&quot;&quot;</span>;</span><br><span class="line">  jsonToSend += <span class="string">&quot;&#125;&quot;</span>;</span><br><span class="line"></span><br><span class="line">  String postString = <span class="string">&quot;POST /devices/&quot;</span>;</span><br><span class="line">  postString += DEVICE_ID;</span><br><span class="line">  postString += <span class="string">&quot;/datapoints?type=3 HTTP/1.1&quot;</span>;</span><br><span class="line">  postString += <span class="string">&quot;\r\n&quot;</span>;</span><br><span class="line">  postString += <span class="string">&quot;api-key:&quot;</span>;</span><br><span class="line">  postString += APIKey;</span><br><span class="line">  postString += <span class="string">&quot;\r\n&quot;</span>;</span><br><span class="line">  postString += <span class="string">&quot;Host:api.heclouds.com\r\n&quot;</span>;</span><br><span class="line">  postString += <span class="string">&quot;Connection:close\r\n&quot;</span>;</span><br><span class="line">  postString += <span class="string">&quot;Content-Length:&quot;</span>;</span><br><span class="line">  postString += jsonToSend.length();</span><br><span class="line">  postString += <span class="string">&quot;\r\n&quot;</span>;</span><br><span class="line">  postString += <span class="string">&quot;\r\n&quot;</span>;</span><br><span class="line">  postString += jsonToSend;</span><br><span class="line">  postString += <span class="string">&quot;\r\n&quot;</span>;</span><br><span class="line">  postString += <span class="string">&quot;\r\n&quot;</span>;</span><br><span class="line">  postString += <span class="string">&quot;\r\n&quot;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">char</span> *postArray = postString.c_str();</span><br><span class="line">  Serial.println(postArray);</span><br><span class="line"></span><br><span class="line">  SIM.write(postArray); delay(<span class="number">100</span>); SIM.write(<span class="number">0x1A</span>);</span><br><span class="line"></span><br><span class="line">  postArray = <span class="literal">NULL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="SIM800C发送短信"><a href="#SIM800C发送短信" class="headerlink" title="SIM800C发送短信"></a>SIM800C发送短信</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">accidentReport</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">  ledWrite(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">  ledWrite(<span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">  Serial.println (<span class="string">&quot;Accident Report Trigged.&quot;</span>);</span><br><span class="line"></span><br><span class="line">  SIM.println(<span class="string">&quot;AT+CIPCLOSE\r&quot;</span>); delay(<span class="number">1000</span>);</span><br><span class="line">  SIM.println(<span class="string">&quot;AT+CIPSTART\r&quot;</span>); delay(<span class="number">5000</span>);</span><br><span class="line"></span><br><span class="line">  String tmp = <span class="string">&quot;AT+CMGS=\&quot;&quot;</span>; tmp += TEL_NUM; tmp += <span class="string">&quot;\&quot;\n\r&quot;</span>;</span><br><span class="line">  Serial.println(tmp);</span><br><span class="line">  <span class="keyword">char</span> buf[<span class="number">10</span>];</span><br><span class="line">  SIM.begin(<span class="number">115200</span>);</span><br><span class="line">  SIM.println(<span class="string">&quot;AT\r\n&quot;</span>); delay(<span class="number">100</span>);</span><br><span class="line">  SIM.println(<span class="string">&quot;AT+CMGF=1\n\r&quot;</span>); delay(<span class="number">500</span>);</span><br><span class="line">  SIM.write(tmp.c_str()); delay(<span class="number">1000</span>);</span><br><span class="line">  SIM.println(<span class="string">&quot;It seems to be an accident.&quot;</span>);</span><br><span class="line"></span><br><span class="line">  tmp = <span class="string">&quot;Location: &quot;</span>;</span><br><span class="line">  dtostrf(Lati, <span class="number">1</span>, <span class="number">4</span>, buf);</span><br><span class="line">  tmp += String(buf);</span><br><span class="line">  dtostrf(Logi, <span class="number">1</span>, <span class="number">4</span>, buf);</span><br><span class="line">  tmp += <span class="string">&quot;, &quot;</span> + String(buf)+<span class="string">&quot;\r&quot;</span>;</span><br><span class="line"></span><br><span class="line">  SIM.write(tmp.c_str());</span><br><span class="line">  delay(<span class="number">1000</span>); SIM.write(<span class="number">0x1A</span>);</span><br><span class="line">  delay (<span class="number">10000</span>); ledWrite(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">  SIM.println(<span class="string">&quot;AT+CIPCLOSE\r&quot;</span>); delay(<span class="number">1000</span>);</span><br><span class="line">  SIM.println(<span class="string">&quot;AT+CIPSTART\r&quot;</span>); delay(<span class="number">5000</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里尤其需要注意和<code>TCP</code>的冲突问题, 这里采用了先断连再重连的实现方式, 但是在实际测试中发现就算不断开连接短信也能够正常发送.</p>
<h4 id="LED灯控制函数"><a href="#LED灯控制函数" class="headerlink" title="LED灯控制函数"></a>LED灯控制函数</h4><p>很方便的LED灯控制手段.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">ledWrite</span> <span class="params">(<span class="keyword">int</span> R, <span class="keyword">int</span> G, <span class="keyword">int</span> B)</span> </span>&#123;</span><br><span class="line">  digitalWrite(LedRed, (<span class="number">255</span>-R)&gt;&gt;LED_LITHT_DEC);</span><br><span class="line">  digitalWrite(LedGre, (<span class="number">255</span>-G)&gt;&gt;LED_LITHT_DEC);</span><br><span class="line">  digitalWrite(LedBlu, (<span class="number">255</span>-B)&gt;&gt;LED_LITHT_DEC);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="红外遥控器编码"><a href="#红外遥控器编码" class="headerlink" title="红外遥控器编码"></a>红外遥控器编码</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">rm_encode</span> <span class="params">(<span class="keyword">long</span> <span class="keyword">long</span> res)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">switch</span> (res) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">0xFF6897</span>: <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="comment">//Show Time</span></span><br><span class="line">    <span class="keyword">case</span> <span class="number">0xFF30CF</span>: <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    <span class="comment">//Show Longitude &amp; Latitude</span></span><br><span class="line">    <span class="keyword">case</span> <span class="number">0xFF18E7</span>: <span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">    <span class="comment">//Show Speed</span></span><br><span class="line">    <span class="keyword">case</span> <span class="number">0xFF7A85</span>: <span class="keyword">return</span> <span class="number">3</span>;</span><br><span class="line">    <span class="comment">//Show Acceleration</span></span><br><span class="line">    <span class="keyword">case</span> <span class="number">0xFF10EF</span>: <span class="keyword">return</span> <span class="number">4</span>;</span><br><span class="line">    <span class="comment">//Show Accelgyro</span></span><br><span class="line">    <span class="keyword">case</span> <span class="number">0xFF38C7</span>: <span class="keyword">return</span> <span class="number">5</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">0xFF5AA5</span>: <span class="keyword">return</span> <span class="number">6</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">0xFF42BD</span>: <span class="keyword">return</span> <span class="number">7</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">0xFF4AB5</span>: <span class="keyword">return</span> <span class="number">8</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">0xFF52AD</span>: <span class="keyword">return</span> <span class="number">9</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">0xFF22DD</span>: <span class="keyword">return</span> <span class="number">1001</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">0xFF02FD</span>: <span class="keyword">return</span> <span class="number">1002</span>;</span><br><span class="line">    <span class="keyword">default</span>: <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="红外遥控信息处理逻辑"><a href="#红外遥控信息处理逻辑" class="headerlink" title="红外遥控信息处理逻辑"></a>红外遥控信息处理逻辑</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">nowPosiModify</span> <span class="params">(<span class="keyword">long</span> <span class="keyword">long</span> res)</span> </span>&#123;</span><br><span class="line">  rettmp=lcd_rm_encode(res);</span><br><span class="line">  <span class="keyword">if</span> (rettmp != <span class="number">-1</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (rettmp&gt;<span class="number">1000</span> &amp;&amp; rettmp&lt;=<span class="number">1100</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">        flag=<span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">switch</span> (rettmp) &#123;</span><br><span class="line">          <span class="keyword">case</span> <span class="number">1001</span>: &#123;ret = (ret+<span class="number">1</span>)%tot_sta; <span class="keyword">break</span>;&#125;</span><br><span class="line">          <span class="keyword">case</span> <span class="number">1002</span>: &#123;ret = --ret&lt;<span class="number">0</span>? ret+tot_sta:ret; <span class="keyword">break</span>;&#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> ret=rettmp, flag=<span class="literal">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  digitalWrite(lcdBackLight, HIGH);</span><br><span class="line"></span><br><span class="line">  <span class="meta">#<span class="meta-keyword">ifdef</span> LCD_OUTPUT</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">switch</span> (ret) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">0</span>: &#123;</span><br><span class="line">      lcd.clear(); lcd.setCursor(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">      lcd.print(Year); lcd.print(<span class="string">&quot;/&quot;</span>);</span><br><span class="line">      <span class="keyword">if</span> (Month&lt;<span class="number">10</span>) lcd.print(<span class="string">&quot;0&quot;</span>); lcd.print(Month); lcd.print(<span class="string">&quot;/&quot;</span>);</span><br><span class="line">      <span class="keyword">if</span> (Day  &lt;<span class="number">10</span>) lcd.print(<span class="string">&quot;0&quot;</span>); lcd.print(Day);</span><br><span class="line">      lcd.setCursor(<span class="number">0</span>, <span class="number">1</span>);</span><br><span class="line">      <span class="keyword">if</span> (Hour&lt;<span class="number">10</span>)   lcd.print(<span class="string">&quot;0&quot;</span>); lcd.print(Hour); lcd.print(<span class="string">&quot;:&quot;</span>);</span><br><span class="line">      <span class="keyword">if</span> (Minute&lt;<span class="number">10</span>) lcd.print(<span class="string">&quot;0&quot;</span>); lcd.print(Minute); lcd.print(<span class="string">&quot;:&quot;</span>);</span><br><span class="line">      <span class="keyword">if</span> (Second&lt;<span class="number">10</span>) lcd.print(<span class="string">&quot;0&quot;</span>); lcd.print(Second);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    &#125; <span class="keyword">case</span> <span class="number">1</span>: &#123;</span><br><span class="line">      lcd.clear(); lcd.setCursor(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">      lcd.print(<span class="string">&quot;Logi: &quot;</span>); lcd.print(Logi);</span><br><span class="line">      lcd.setCursor(<span class="number">0</span>, <span class="number">1</span>);</span><br><span class="line">      lcd.print(<span class="string">&quot;Lati: &quot;</span>); lcd.print(Lati);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    &#125; <span class="keyword">case</span> <span class="number">2</span>: &#123;</span><br><span class="line">      lcd.clear(); lcd.setCursor(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">      lcd.print (<span class="string">&quot;Speed(Kmph): &quot;</span>);</span><br><span class="line">      lcd.setCursor(<span class="number">0</span>, <span class="number">1</span>); lcd.print(Skmph);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    &#125; <span class="keyword">case</span> <span class="number">3</span>: &#123;</span><br><span class="line">      lcd.clear(); lcd.setCursor(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">      lcd.print (<span class="string">&quot;Acceleration:&quot;</span>);</span><br><span class="line">      lcd.setCursor(<span class="number">0</span>, <span class="number">1</span>); lcd.print(Acce);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    &#125; <span class="keyword">case</span> <span class="number">4</span>: &#123;</span><br><span class="line">      lcd.clear(); lcd.setCursor(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">      lcd.print(<span class="string">&quot;x:&quot;</span>); lcd.print(agx);</span><br><span class="line">      lcd.print(<span class="string">&quot; y:&quot;</span>); lcd.print(agy);</span><br><span class="line">      lcd.setCursor(<span class="number">0</span>, <span class="number">1</span>);</span><br><span class="line">      lcd.print(<span class="string">&quot;z:&quot;</span>); lcd.print(agz);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; rettmp = <span class="number">-1</span>;</span><br><span class="line"></span><br><span class="line">  <span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">  <span class="meta">#<span class="meta-keyword">ifdef</span> DEBUG</span></span><br><span class="line">  <span class="comment">//Serial.print(&quot;ret: &quot;);</span></span><br><span class="line">  <span class="comment">//Serial.print(ret);</span></span><br><span class="line">  <span class="comment">//Serial.print(&quot; tettmp: &quot;);</span></span><br><span class="line">  <span class="comment">//Serial.println(rettmp);</span></span><br><span class="line">  <span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="事故侦测"><a href="#事故侦测" class="headerlink" title="事故侦测"></a>事故侦测</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> durVal = <span class="number">150</span>;</span><br><span class="line"><span class="keyword">double</span> tmpAgx[durVal], tmpAgy[durVal], tmpAgz[durVal];</span><br><span class="line"><span class="keyword">int</span> pos, totx, toty, totz;</span><br><span class="line"><span class="keyword">double</span> avgx, avgy, avgz;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">bool</span> <span class="title">isRotate</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">  getAcce(); <span class="keyword">register</span> <span class="keyword">bool</span> flag = <span class="literal">false</span>;</span><br><span class="line">  <span class="keyword">register</span> <span class="keyword">double</span> acce = <span class="built_in">sqrt</span>(accx*accx + accy*accy + accz*accz);</span><br><span class="line">  </span><br><span class="line">  flag = acce&gt;=ACCIDENT_ACCE;</span><br><span class="line">  <span class="keyword">if</span> (Abs(agx-avgx)&gt;ACCIDENT_ANGLE || Abs(agy-avgy)&gt;ACCIDENT_ANGLE || Abs(agz-avgz)&gt;ACCIDENT_ANGLE) flag = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">  totx -= tmpAgx[pos], toty -= tmpAgy[pos], totz -= tmpAgz[pos];</span><br><span class="line">  tmpAgx[pos] = agx, tmpAgy[pos]= agy, tmpAgz[pos] = agz;</span><br><span class="line">  totx += agx, toty += agy, totz += agz;</span><br><span class="line">  avgx = <span class="number">1.0</span>*totx/(<span class="number">1.0</span>*durVal), avgy = <span class="number">1.0</span>*toty/(<span class="number">1.0</span>*durVal), avgz = <span class="number">1.0</span>*totz/(<span class="number">1.0</span>*durVal);</span><br><span class="line">  pos = (pos+<span class="number">1</span>)%durVal;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> flag;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (accidentMonitor.check()) &#123;</span><br><span class="line">  <span class="keyword">if</span> (isRotate() &amp;&amp; Skmph&gt;=ACCIDENT_ALERT_SPEED) accidentReport();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>使用循环数组存储$150$个运行周期中三维陀螺仪的倾角信息, 通过更新循环数组求$150$个运行周期中的三维倾角平均值.</p>
<p><code>acce</code>为三维加速度的等效值.</p>
<p>报警条件: 等效加速度大小大于阈值<code>ACCIDENT_ ACCE</code>, 并且三个方向上的倾角只要有一个倾角相对于$30$个运行周期中的平均值的差的绝对值大于阈值<code>ACCIDENT_ANGEL</code>, 并且当前<code>GPS</code>速度大于阈值<code>ACCIDENT_ALERT_SPEED</code>, 即可触发报警.</p>
<p>需要注意的一点: <code>if</code>语句中各个判断条件从左向右计算, 如果发现在某种情况下判断结果已经可以确定, 其余的部分将不会被计算. 为了能够保证维护的循环数组的连续性, 我们牺牲了部分低速或静息状态下的续航和性能, 保证<code>isRotate()</code>在每一个程序周期中都会被调用.</p>
<p><img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.15.12/img/HYAH/20201127_232804.jpg" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.15.12/img/HYAH/20201127_232804.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="事故报警"></p>
<h4 id="Bad-Attempt-向-Arduino-UNO-移植"><a href="#Bad-Attempt-向-Arduino-UNO-移植" class="headerlink" title="[Bad Attempt] 向 Arduino  UNO 移植"></a>[<strong><font color=red>Bad Attempt</font></strong>] 向 <code>Arduino  UNO</code> 移植</h4><p>想要做<code>Arduino</code>最小系统进一步减小体积, 后来发现有各种问题, 故终止.</p>
<p>失败原因: <code>ATMEGA328PU</code>性能太差, <code>RAM</code>太小, 实现功能要用到的动态存储空间太大.</p>
<p>下文简单介绍一下挣扎时用到的一些可能有用的操作.</p>
<h5 id="减小RAM占用"><a href="#减小RAM占用" class="headerlink" title="减小RAM占用"></a><strong>减小<code>RAM</code>占用</strong></h5><p><code>ATMEGA2560</code>足足有<code>8K</code>的<code>SRAM</code>, 但<code>ATMEGA328PU</code>只有<code>2K</code>, 我当场<code>MLE</code>.</p>
<p><del>学OI那阵子松松松都是松时间, 从来不用担心<code>MLE</code>, 上了带学连空间都要松, 这就是当代带学生吗 (雾</del></p>
<p><img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/HYAH/uno/ramcrash.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/HYAH/uno/ramcrash.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="炸内存之惨状"></p>
<p>解决方案:</p>
<h6 id="将静态变量内容存入Flash"><a href="#将静态变量内容存入Flash" class="headerlink" title="将静态变量内容存入Flash."></a>将静态变量内容存入<code>Flash</code>.</h6><p>在静态变量前面加<code>PROGMEM</code>修饰, 可以将静态变量存入<code>Flash</code>, 以减少<code>RAM</code>占用.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PROGMEM <span class="keyword">const</span> <span class="keyword">double</span> pi = <span class="number">3.1415926</span>, AcceRatio = <span class="number">16384.0</span>, GyroRatio = <span class="number">131.0</span>;</span><br></pre></td></tr></table></figure>

<h6 id="将字符串常量存入Flash"><a href="#将字符串常量存入Flash" class="headerlink" title="将字符串常量存入Flash."></a>将字符串常量存入<code>Flash</code>.</h6><p>字符串常量通常被存入静态内存区, 将其用<code>F()</code>修饰可以将其存入<code>Flash</code>.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SIM.println(F(<span class="string">&quot;AT+CIPCSGP=1,\&quot;CMNET\&quot;\r&quot;</span>)); sleep(<span class="number">100</span>);</span><br><span class="line">SIM.println(F(<span class="string">&quot;AT+CLPORT=\&quot;TCP\&quot;,\&quot;2000\&quot;\r&quot;</span>)); sleep(<span class="number">500</span>);</span><br><span class="line">SIM.println(F(<span class="string">&quot;AT+CIPSTART=\&quot;TCP\&quot;,\&quot;183.230.40.33\&quot;,\&quot;80\&quot;\r&quot;</span>));</span><br></pre></td></tr></table></figure>

<h5 id="烧写bootloader"><a href="#烧写bootloader" class="headerlink" title="烧写bootloader"></a><strong>烧写<code>bootloader</code></strong></h5><p>有几次炸内存之后<code>Arduino</code>板工作不正常, 甚至无法正常烧录程序, 抱着尝试的心态重新烧写引导程序, 它奇迹般地复活了.</p>
<ol start="0">
<li>硬件连接(常用)</li>
</ol>
<p><img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/HYAH/bootloader/MegaToUNO.jpg" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/HYAH/bootloader/MegaToUNO.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="Mega to UNO"></p>
<blockquote>
<p>The <code>10µF</code> electrolytic capacitor connected to <code>RESET</code> and <code>GND</code> of the programming board is needed <code>only</code> for the boards that have an interface between the microcontroller and the computer’s USB, like Mega, Uno, Mini, Nano. Boards like Leonardo, Esplora and Micro, with the USB directly managed by the microcontroller, don’t need the capacitor.</p>
</blockquote>
<p>实际用<code>Mega</code>测试的时候发现电容不加也行. (笑</p>
<p><img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/HYAH/bootloader/ArduinoUNOtoUNO_ISP2.jpg" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/HYAH/bootloader/ArduinoUNOtoUNO_ISP2.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="UNO to UNO"></p>
<ol>
<li>在工具栏 <code>工具</code>-&gt;<code>开发板</code> 中选择<code>PROGRAMMER</code>的正确开发板型号及处理器型号.</li>
<li>在工具栏 <code>工具</code>-&gt;<code>编程器</code> 中选择<code>AVRISP</code>编程器.</li>
</ol>
<p><img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/HYAH/bootloader/btl2.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/HYAH/bootloader/btl2.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p>
<ol start="3">
<li>在工具栏 <code>文件</code>-&gt;<code>示例</code>-&gt;<code>ArduinoISP</code> 中打开<code>ArduinoISP</code>例程, 编译并烧录到<code>PROGRAMMER</code>中.</li>
</ol>
<p><img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/HYAH/bootloader/btl1.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/HYAH/bootloader/btl1.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p>
<ol start="4">
<li>在工具栏 <code>工具</code>-&gt;<code>开发板</code> 中选择<code>TARGET</code>的正确开发板型号和处理器型号.</li>
<li>在工具栏 <code>工具</code>-&gt;<code>编程器</code> 中选择<code>Arduino as ISP</code>, 并点击下方的<code>烧录引导程序</code>. 等待即可.</li>
</ol>
<p><img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/HYAH/bootloader/btl3.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/HYAH/bootloader/btl3.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p>
<p>更多内容详见官网相关文档<a target="_blank" rel="noopener" href="https://www.arduino.cc/en/Tutorial/BuiltInExamples/ArduinoISP">ArduinoISP</a>.</p>
<h3 id="微信小程序"><a href="#微信小程序" class="headerlink" title="微信小程序"></a>微信小程序</h3><div class="note warning red"><p>由于微信小程序部分码量巨大 且只有定位功能是我们项目的核心功能 本Wiki中关于微信小程序将只针对于定位页面进行讲解 账号授权 新建活动 活动报名 资讯 相册 添加新设备等附属功能请自行查看代码.</p></div>

<h4 id="WG-84-to-GCJ-02-坐标转换"><a href="#WG-84-to-GCJ-02-坐标转换" class="headerlink" title="WG-84 to GCJ-02 坐标转换"></a>WG-84 to GCJ-02 坐标转换</h4><p>首先参考 <a target="_blank" rel="noopener" href="https://www.cnblogs.com/langzou/p/10402501.html">GCJ-02火星坐标系和WGS-84坐标系转换关系</a>, 得:</p>
<p><img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.15.1/img/HYAH/wg84.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.15.1/img/HYAH/wg84.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p>
<p>然后参考 <a target="_blank" rel="noopener" href="https://www.zhihu.com/question/55648210">已知不可逆的坐标转换算法，通过结果进行反算的方法</a> 进行坐标逆变换.</p>
<p>我们只能先认为 <code>WGS-84</code> 转到 <code>GCJ-02</code> 的精确公式是存在的，这是我们做 <code>GCJ-02</code> 到 <code>WGS-84</code> 公式逆变换的前提，否则我们或许只能黑箱操作（其实我们已经进行了黑箱操作，但是效果不好）。经过一番操作，我们凑巧得出如下公式：</p>
<p><img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.15.1/img/HYAH/wg84togcj02.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.15.1/img/HYAH/wg84togcj02.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p>
<p>在小程序中进行处理后, 在传入坐标精度为6位小数即可一定程度上保证坐标精准度.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> wgs84togcj02 = <span class="function"><span class="keyword">function</span>(<span class="params">lat, log</span>) </span>&#123;</span><br><span class="line">  <span class="comment">//is position off China mainland</span></span><br><span class="line">  <span class="keyword">if</span> (log &lt; <span class="number">72.004</span> || log &gt; <span class="number">137.8347</span> || lat &lt; <span class="number">0.8293</span> || lat &gt; <span class="number">55.8271</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      latitude: lat,</span><br><span class="line">      longitude: log,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> Pi = <span class="number">3.14159265358979324</span>;</span><br><span class="line">    <span class="comment">//coordinate projection factor</span></span><br><span class="line">    <span class="keyword">const</span> a = <span class="number">6378245.0</span>;</span><br><span class="line">    <span class="comment">//eccentricity</span></span><br><span class="line">    <span class="keyword">const</span> ee = <span class="number">0.00669342162296594323</span>;</span><br><span class="line">    <span class="comment">//All Hail ELLIAS</span></span><br><span class="line">    <span class="keyword">var</span> transformLat = <span class="function"><span class="keyword">function</span> (<span class="params">x, y</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> ret = <span class="number">-100.0</span> + <span class="number">2.0</span> * x + <span class="number">3.0</span> * y + <span class="number">0.2</span> * y * y + <span class="number">0.1</span> * x * y + <span class="number">0.2</span> * <span class="built_in">Math</span>.sqrt(<span class="built_in">Math</span>.abs(x));</span><br><span class="line">      ret += (<span class="number">20.0</span> * <span class="built_in">Math</span>.sin(<span class="number">6.0</span> * x * Pi) + <span class="number">20.0</span> * <span class="built_in">Math</span>.sin(<span class="number">2.0</span> * x * Pi)) * <span class="number">2.0</span> / <span class="number">3.0</span>;</span><br><span class="line">      ret += (<span class="number">20.0</span> * <span class="built_in">Math</span>.sin(y * Pi) + <span class="number">40.0</span> * <span class="built_in">Math</span>.sin(y / <span class="number">3.0</span> * Pi)) * <span class="number">2.0</span> / <span class="number">3.0</span>;</span><br><span class="line">      ret += (<span class="number">160.0</span> * <span class="built_in">Math</span>.sin(y / <span class="number">12.0</span> * Pi) + <span class="number">320</span> * <span class="built_in">Math</span>.sin(y * Pi / <span class="number">30.0</span>)) * <span class="number">2.0</span> / <span class="number">3.0</span>;</span><br><span class="line">      <span class="keyword">return</span> ret; &#125;</span><br><span class="line">    <span class="keyword">var</span> transformLog = <span class="function"><span class="keyword">function</span> (<span class="params">x, y</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> ret = <span class="number">300.0</span> + x + <span class="number">2.0</span> * y + <span class="number">0.1</span> * x * x + <span class="number">0.1</span> * x * y + <span class="number">0.1</span> * <span class="built_in">Math</span>.sqrt(<span class="built_in">Math</span>.abs(x));</span><br><span class="line">      ret += (<span class="number">20.0</span> * <span class="built_in">Math</span>.sin(<span class="number">6.0</span> * x * Pi) + <span class="number">20.0</span> * <span class="built_in">Math</span>.sin(<span class="number">2.0</span> * x * Pi)) * <span class="number">2.0</span> / <span class="number">3.0</span>;</span><br><span class="line">      ret += (<span class="number">20.0</span> * <span class="built_in">Math</span>.sin(x * Pi) + <span class="number">40.0</span> * <span class="built_in">Math</span>.sin(x / <span class="number">3.0</span> * Pi)) * <span class="number">2.0</span> / <span class="number">3.0</span>;</span><br><span class="line">      ret += (<span class="number">150.0</span> * <span class="built_in">Math</span>.sin(x / <span class="number">12.0</span> * Pi) + <span class="number">300.0</span> * <span class="built_in">Math</span>.sin(x / <span class="number">30.0</span> * Pi)) * <span class="number">2.0</span> / <span class="number">3.0</span>;</span><br><span class="line">      <span class="keyword">return</span> ret; &#125;</span><br><span class="line">    <span class="keyword">var</span> delta = <span class="function"><span class="keyword">function</span> (<span class="params">lat, lon</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> dLat = transformLat(lon - <span class="number">105.0</span>, lat - <span class="number">35.0</span>);</span><br><span class="line">      <span class="keyword">var</span> dLon = transformLog(lon - <span class="number">105.0</span>, lat - <span class="number">35.0</span>);</span><br><span class="line">      <span class="keyword">var</span> radLat = lat / <span class="number">180.0</span> * Pi;</span><br><span class="line">      <span class="keyword">var</span> magic = <span class="built_in">Math</span>.sin(radLat);</span><br><span class="line">      magic = <span class="number">1</span> - ee * magic * magic;</span><br><span class="line">      <span class="keyword">var</span> sqrtMagic = <span class="built_in">Math</span>.sqrt(magic);</span><br><span class="line">      dLat = (dLat * <span class="number">180.0</span>) / ((a * (<span class="number">1</span> - ee)) / (magic * sqrtMagic) * Pi);</span><br><span class="line">      dLon = (dLon * <span class="number">180.0</span>) / (a / sqrtMagic * <span class="built_in">Math</span>.cos(radLat) * Pi);</span><br><span class="line">      <span class="keyword">return</span> &#123;<span class="string">&#x27;lat&#x27;</span>: dLat, <span class="string">&#x27;lon&#x27;</span>: dLon&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> d = delta(lat, log);</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      latitude:  lat + d.lat,</span><br><span class="line">      longitude: log + d.lon,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="数据实时刷新"><a href="#数据实时刷新" class="headerlink" title="数据实时刷新"></a>数据实时刷新</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//location data getter timer</span></span><br><span class="line">timer = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">this</span>.get_datapoints().then(<span class="function"><span class="params">datapoints</span> =&gt;</span> &#123;&#125;)</span><br><span class="line">&#125;, <span class="number">3000</span>)</span><br></pre></td></tr></table></figure>

<div class="note warning red"><p><code>event</code>到期后<code>timer</code>将会停止工作.</p></div>

<h4 id="获取当前event"><a href="#获取当前event" class="headerlink" title="获取当前event"></a>获取当前event</h4><div class="note info"><p>本项目中将不同的使用节次虚拟化为不同的event.</p></div>

<p>只有在<code>event</code>中<code>register</code>才有权限上传图片.</p>
<p>只能在<code>event</code>开始前12h到<code>event</code>结束后1天的时间范围内上传图片. 如果event结束, <code>timer</code>也不会再更新.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//get the corresponded event</span></span><br><span class="line"><span class="keyword">var</span> event = app.globalData.event;</span><br><span class="line"><span class="keyword">var</span> participants = event.participants;</span><br><span class="line"><span class="keyword">var</span> is_signed = <span class="literal">false</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; participants.length; i++) &#123;</span><br><span class="line">  <span class="keyword">if</span> (app.globalData.user.openid == participants[i].openid) &#123;</span><br><span class="line">    <span class="comment">//matching current user</span></span><br><span class="line">    <span class="comment">//check whether the event is expired, -12h to 1d</span></span><br><span class="line">    <span class="keyword">var</span> can_upload = ((((<span class="built_in">Date</span>.now() - event.precise_time) / <span class="number">86400000</span>) &gt;= <span class="number">1</span>) || (((<span class="built_in">Date</span>.now() - event.precise_time) / <span class="number">86400000</span>) &lt;= <span class="number">-0.5</span>)) ? <span class="literal">false</span> : <span class="literal">true</span>;</span><br><span class="line">    <span class="comment">//fill the basic event name info and decide whether the uploader should be shown or not</span></span><br><span class="line">    <span class="built_in">this</span>.setData(&#123;</span><br><span class="line">      event: event,</span><br><span class="line">      all_snapshots_tip: <span class="string">&quot;查看&quot;</span> + event.name + <span class="string">&quot;的全部图片&quot;</span>,</span><br><span class="line">      is_uploader_hide: !can_upload,</span><br><span class="line">      tip_footer: <span class="string">&quot;请在活动开始前12小时到活动结束后1天内上传图片&quot;</span></span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">if</span> (((<span class="built_in">Date</span>.now() - event.precise_time) / <span class="number">86400000</span>) &gt;= <span class="number">1</span>) &#123;</span><br><span class="line">      <span class="built_in">clearInterval</span>(timer);</span><br><span class="line">      <span class="built_in">this</span>.setData(&#123;</span><br><span class="line">        tip_footer: <span class="string">&quot;活动已结束&quot;</span>,</span><br><span class="line">        is_dynamic_data_hide: <span class="literal">true</span></span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="comment">//event expired, clear interval</span></span><br><span class="line">    &#125;</span><br><span class="line">    is_signed = <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//cannot upload if unsigned</span></span><br><span class="line">  <span class="keyword">if</span> (!is_signed) &#123;</span><br><span class="line">    <span class="built_in">this</span>.setData(&#123;</span><br><span class="line">      event: event,</span><br><span class="line">      all_snapshots_tip: <span class="string">&quot;查看&quot;</span> + event.name + <span class="string">&quot;的全部图片&quot;</span>,</span><br><span class="line">      is_uploader_hide: <span class="literal">true</span>,</span><br><span class="line">      tip_footer: <span class="string">&quot;未报名活动，无法上传图片&quot;</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="从数据库中获取当前event所对应的图片表"><a href="#从数据库中获取当前event所对应的图片表" class="headerlink" title="从数据库中获取当前event所对应的图片表"></a>从数据库中获取当前event所对应的图片表</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line">db.collection(<span class="string">&quot;events&quot;</span>).where(&#123;</span><br><span class="line">      _id: event._id</span><br><span class="line">    &#125;).field(&#123;</span><br><span class="line">      _id: <span class="literal">true</span>,</span><br><span class="line">      snapshots: <span class="literal">true</span></span><br><span class="line">    &#125;).get(&#123;</span><br><span class="line">      success: <span class="function"><span class="keyword">function</span> (<span class="params">res</span>) </span>&#123;</span><br><span class="line">        <span class="comment">//all shots taken in the event</span></span><br><span class="line">        <span class="keyword">var</span> snapshots = res.data[<span class="number">0</span>].snapshots</span><br><span class="line">        that.setData(&#123;</span><br><span class="line">          event_id: res.data[<span class="number">0</span>]._id,</span><br><span class="line">          event_shots: snapshots</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="keyword">var</span> markers = [];</span><br><span class="line">        markers[<span class="number">0</span>] = &#123;</span><br><span class="line">          id: <span class="number">0</span>,</span><br><span class="line">          latitude: that.data.latitude,</span><br><span class="line">          longitude: that.data.longitude,</span><br><span class="line">          width: <span class="number">20</span>,</span><br><span class="line">          height: <span class="number">20</span>,</span><br><span class="line">          iconPath: <span class="string">&quot;image/star.png&quot;</span>,</span><br><span class="line">          callout: &#123;</span><br><span class="line">            content: that.data.event.device.name + <span class="string">&quot;：&quot;</span> + that.data.event.device.deviceid,</span><br><span class="line">            bgColor: <span class="string">&quot;#fff&quot;</span>,</span><br><span class="line">            padding: <span class="string">&quot;5px&quot;</span>,</span><br><span class="line">            borderRadius: <span class="string">&quot;5px&quot;</span>,</span><br><span class="line">            borderWidth: <span class="string">&quot;1px&quot;</span>,</span><br><span class="line">            borderColor: <span class="string">&quot;#1296DB&quot;</span>,</span><br><span class="line">            display: <span class="string">&quot;BYCLICK&quot;</span>,</span><br><span class="line">            fontSize: <span class="string">&quot;10&quot;</span>,</span><br><span class="line">          &#125;,</span><br><span class="line">          is_snapshot: <span class="literal">false</span></span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; snapshots.length; i++) &#123;</span><br><span class="line">          <span class="keyword">var</span> snapshot = snapshots[i];</span><br><span class="line">          <span class="keyword">var</span> marker = &#123;&#125;;</span><br><span class="line">          <span class="comment">//geopoint need to be transformed to json</span></span><br><span class="line">          <span class="keyword">var</span> location = snapshot.location.toJSON().coordinates;</span><br><span class="line">          marker.id = i + <span class="number">1</span>;</span><br><span class="line">          marker.location = snapshot.location;</span><br><span class="line">          marker.longitude = location[<span class="number">0</span>];</span><br><span class="line">          marker.latitude = location[<span class="number">1</span>];</span><br><span class="line">          marker.openid = snapshot.openid;</span><br><span class="line">          marker.name = snapshot.name;</span><br><span class="line">          marker.avatar = snapshot.avatar;</span><br><span class="line">          marker.nickname = snapshot.nickname;</span><br><span class="line">          marker.realname = snapshot.realname;</span><br><span class="line">          marker.taker = snapshot.nickname + <span class="string">&quot; (&quot;</span> + snapshot.realname + <span class="string">&quot;)&quot;</span>;</span><br><span class="line">          marker.detail = snapshot.detail;</span><br><span class="line">          marker.iconPath = <span class="string">&quot;image/imagepoint.png&quot;</span>;</span><br><span class="line">          marker.url = snapshot.url;</span><br><span class="line">          marker.width = <span class="number">20</span>;</span><br><span class="line">          marker.height = <span class="number">20</span>;</span><br><span class="line">          marker.callout = &#123;</span><br><span class="line">            content: snapshot.detail,</span><br><span class="line">            bgColor: <span class="string">&quot;#fff&quot;</span>,</span><br><span class="line">            padding: <span class="string">&quot;5px&quot;</span>,</span><br><span class="line">            borderRadius: <span class="string">&quot;5px&quot;</span>,</span><br><span class="line">            borderWidth: <span class="string">&quot;1px&quot;</span>,</span><br><span class="line">            borderColor: <span class="string">&quot;#1485EF&quot;</span>,</span><br><span class="line">            display: <span class="string">&quot;ALWAYS&quot;</span>,</span><br><span class="line">            fontSize: <span class="string">&quot;10&quot;</span>,</span><br><span class="line">          &#125;;</span><br><span class="line">          marker.is_snapshot = <span class="literal">true</span>;</span><br><span class="line">          markers.push(marker);</span><br><span class="line">          <span class="comment">//deviation, prevent markers from overlapping</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; markers.length; i++) &#123;</span><br><span class="line">          <span class="keyword">var</span> marker = markers[i];</span><br><span class="line">          <span class="keyword">for</span> (<span class="keyword">var</span> j = <span class="number">0</span>; j &lt; markers.length; j++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (markers[j].location == marker.location) &#123;</span><br><span class="line">              markers[j].longitude += i * <span class="number">0.0002</span>;</span><br><span class="line">              markers[j].latitude += i * <span class="number">0.0002</span>;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">console</span>.log(markers);</span><br><span class="line">        that.setData(&#123;</span><br><span class="line">          markers: markers</span><br><span class="line">        &#125;)</span><br><span class="line">        wx.hideLoading(&#123;</span><br><span class="line">          complete: <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;&#125;,</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br></pre></td></tr></table></figure>

<p>当前定位点和图片定位点都需要用<code>markers[]</code>盛放, 为了避免渲染冲突, 我们将当前定位点存在<code>markers[0]</code>中, 并对其单独赋值.</p>
<p>如果有坐标相同的定位点, 为了防止它们重合, 这里单独做了特判, 将每一对中重合的标记点其中的一个平移.</p>
<h4 id="从OneNet获取设备信息"><a href="#从OneNet获取设备信息" class="headerlink" title="从OneNet获取设备信息"></a>从OneNet获取设备信息</h4><p><code>wgs84togcj02</code>函数在上文有提及.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//get gps datapoints</span></span><br><span class="line">get_datapoints: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> that = <span class="built_in">this</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    wx.request(&#123;</span><br><span class="line">      url: <span class="string">`https://api.heclouds.com/devices/<span class="subst">$&#123;that.data.event.device.deviceid&#125;</span>/datapoints?datastream_id=Latitude,Logitude,Speed&amp;limit=1`</span>,</span><br><span class="line">      header: &#123;</span><br><span class="line">        <span class="string">&#x27;content-type&#x27;</span>: <span class="string">&#x27;application/json&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;api-key&#x27;</span>: that.data.event.device.apikey</span><br><span class="line">      &#125;,</span><br><span class="line">      success: <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> status = res.statusCode;</span><br><span class="line">        <span class="keyword">const</span> response = res.data;</span><br><span class="line">        <span class="keyword">var</span> speed = response.data.datastreams[<span class="number">0</span>].datapoints;</span><br><span class="line">        <span class="keyword">var</span> longitude = response.data.datastreams[<span class="number">1</span>].datapoints;</span><br><span class="line">        <span class="keyword">var</span> latitude = response.data.datastreams[<span class="number">2</span>].datapoints;</span><br><span class="line">        <span class="keyword">var</span> current_sp = <span class="built_in">Number</span>(speed[speed.length - <span class="number">1</span>].value);</span><br><span class="line">        <span class="keyword">var</span> current_lo = <span class="built_in">Number</span>(longitude[longitude.length - <span class="number">1</span>].value);</span><br><span class="line">        <span class="keyword">var</span> current_la = <span class="built_in">Number</span>(latitude[latitude.length - <span class="number">1</span>].value);</span><br><span class="line">        <span class="comment">//encrypt to gcj to fit Tencent map</span></span><br><span class="line">        <span class="keyword">const</span> encrypt_res = wgs84togcj02(current_la, current_lo);</span><br><span class="line">        that.setData(&#123;</span><br><span class="line">          speed: current_sp,</span><br><span class="line">          longitude: encrypt_res.longitude,</span><br><span class="line">          latitude: encrypt_res.latitude,</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;[onenet][speed]: &quot;</span> + that.data.speed);</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;[onenet][latitude]: &quot;</span> + that.data.latitude);</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;[onenet][longitude]: &quot;</span> + that.data.longitude);</span><br><span class="line">        <span class="keyword">if</span> (status !== <span class="number">200</span>) &#123;</span><br><span class="line">          reject(res.data)</span><br><span class="line">          <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (response.errno !== <span class="number">0</span>) &#123;</span><br><span class="line">          reject(response.error)</span><br><span class="line">          <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (response.data.datastreams.length === <span class="number">0</span>) &#123;</span><br><span class="line">          reject(<span class="string">&quot;No data yet.&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        resolve(&#123;&#125;)</span><br><span class="line">      &#125;,</span><br><span class="line">      fail: <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">        reject(err)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p>使用<code>Promise</code>取消异步.</p>
<h4 id="在地图上点击图片点"><a href="#在地图上点击图片点" class="headerlink" title="在地图上点击图片点"></a>在地图上点击图片点</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//marker tapped</span></span><br><span class="line">show_snapshots: <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> id = e.detail.markerId;</span><br><span class="line">  <span class="keyword">var</span> markers = <span class="built_in">this</span>.data.markers;</span><br><span class="line">  <span class="keyword">if</span> (id == <span class="number">0</span>) <span class="keyword">return</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">1</span>; i &lt; <span class="built_in">this</span>.data.markers.length; i++) &#123;</span><br><span class="line">    markers[i].iconPath = <span class="string">&quot;image/imagepoint.png&quot;</span>;</span><br><span class="line">    markers[i].callout.borderColor = <span class="string">&quot;#1485EF&quot;</span>;</span><br><span class="line">    <span class="comment">//change imagepoint to red</span></span><br><span class="line">    <span class="keyword">if</span> (i == id) &#123;</span><br><span class="line">      markers[i].iconPath = <span class="string">&quot;image/imagepoint_selected.png&quot;</span>;</span><br><span class="line">      markers[i].callout.borderColor = <span class="string">&quot;#EF2914&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">var</span> current_marker = markers[id];</span><br><span class="line">  <span class="built_in">this</span>.setData(&#123;</span><br><span class="line">    markers: markers,</span><br><span class="line">    current_marker: current_marker,</span><br><span class="line">    is_image_previewer_hide: <span class="literal">false</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<h4 id="显示所有图片"><a href="#显示所有图片" class="headerlink" title="显示所有图片"></a>显示所有图片</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//show all tab tapped</span></span><br><span class="line">show_all_snapshots: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">//no snapshot</span></span><br><span class="line">  <span class="keyword">var</span> event = <span class="built_in">this</span>.data.event;</span><br><span class="line">  <span class="keyword">if</span> (!<span class="built_in">this</span>.data.event.snapshots_count) &#123;</span><br><span class="line">    <span class="built_in">this</span>.setData(&#123;</span><br><span class="line">      all_snapshots_tip: <span class="string">&quot;暂无图片&quot;</span></span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//has snapshots</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">this</span>.data.is_all_Hide) &#123;</span><br><span class="line">    <span class="built_in">this</span>.setData(&#123;</span><br><span class="line">      is_all_Hide: <span class="literal">false</span>,</span><br><span class="line">      all_snapshots_tip: <span class="string">&quot;收起&quot;</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.setData(&#123;</span><br><span class="line">      is_all_Hide: <span class="literal">true</span>,</span><br><span class="line">      all_snapshots_tip: <span class="string">&quot;查看&quot;</span> + <span class="built_in">this</span>.data.event.name + <span class="string">&quot;全部图片&quot;</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<h4 id="选择上传位点"><a href="#选择上传位点" class="headerlink" title="选择上传位点"></a>选择上传位点</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">choose_location: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> that = <span class="built_in">this</span>;</span><br><span class="line">    wx.chooseLocation(&#123;</span><br><span class="line">      latitude: that.data.latitude,</span><br><span class="line">      longitude: that.data.longitude,</span><br><span class="line">      complete: <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!res.name) &#123;</span><br><span class="line">          <span class="built_in">this</span>.setData(&#123;</span><br><span class="line">            tip: <span class="string">&quot;未选中位置，点我重新选择&quot;</span></span><br><span class="line">          &#125;)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="built_in">this</span>.setData(&#123;</span><br><span class="line">            tip: res.name</span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">this</span>.data.snapshots.avatar = app.globalData.user.avatar;</span><br><span class="line">        <span class="built_in">this</span>.data.snapshots.openid = app.globalData.user.openid;</span><br><span class="line">        <span class="built_in">this</span>.data.snapshots.nickname = app.globalData.user.nickname;</span><br><span class="line">        <span class="built_in">this</span>.data.snapshots.realname = app.globalData.user.realname;</span><br><span class="line">        <span class="built_in">this</span>.data.snapshots.name = res.name;</span><br><span class="line">        <span class="built_in">this</span>.data.snapshots.location = db.Geo.Point(res.longitude, res.latitude);</span><br><span class="line">        <span class="keyword">var</span> d = <span class="keyword">new</span> <span class="built_in">Date</span>();</span><br><span class="line">        <span class="built_in">this</span>.data.snapshots.time = d.getTime();</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span>.data.detail) &#123;</span><br><span class="line">          <span class="built_in">this</span>.data.snapshots.detail = <span class="built_in">this</span>.data.detail;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="built_in">this</span>.data.snapshots.detail = <span class="string">&quot;暂无描述&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure>

<h4 id="选择要上传的图片"><a href="#选择要上传的图片" class="headerlink" title="选择要上传的图片"></a>选择要上传的图片</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//the rider choose an image from snapshots just taken</span></span><br><span class="line">choose_image: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">this</span>.data.files.length &gt;= <span class="number">1</span>) &#123;</span><br><span class="line">    wx.showToast(&#123;</span><br><span class="line">      title: <span class="string">&#x27;每位用户单个地点最多上传一张图片&#x27;</span>,</span><br><span class="line">      icon: <span class="string">&quot;none&quot;</span></span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">var</span> that = <span class="built_in">this</span>;</span><br><span class="line">  wx.chooseImage(&#123;</span><br><span class="line">    <span class="comment">//choose compressd image to get faster upload and save data</span></span><br><span class="line">    sizeType: [<span class="string">&#x27;original&#x27;</span>, <span class="string">&#x27;compressed&#x27;</span>],</span><br><span class="line">    count: <span class="number">1</span>,</span><br><span class="line">    <span class="comment">//take a snapshot or choose a photo</span></span><br><span class="line">    sourceType: [<span class="string">&#x27;album&#x27;</span>, <span class="string">&#x27;camera&#x27;</span>],</span><br><span class="line">    success: <span class="function"><span class="keyword">function</span> (<span class="params">res</span>) </span>&#123;</span><br><span class="line">      <span class="comment">//check the size of the image</span></span><br><span class="line">      <span class="keyword">var</span> maxsize = <span class="number">4000000</span>;</span><br><span class="line">      <span class="keyword">if</span> (res.tempFiles[<span class="number">0</span>].size &gt; maxsize) &#123;</span><br><span class="line">        <span class="keyword">var</span> original_size = (res.tempFiles[<span class="number">0</span>].size / <span class="number">1000000</span>).toFixed(<span class="number">2</span>);</span><br><span class="line">        wx.showToast(&#123;</span><br><span class="line">          title: <span class="string">&#x27;图片过大(&#x27;</span> + original_size + <span class="string">&#x27;MB&#x27;</span> + <span class="string">&#x27;)，请取消勾选&quot;原图&quot;或另行上传较小的图片&#x27;</span>,</span><br><span class="line">          icon: <span class="string">&#x27;none&#x27;</span></span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">//return file path and attach to page data filepath array</span></span><br><span class="line">      that.setData(&#123;</span><br><span class="line">        files: that.data.files.concat(res.tempFilePaths),</span><br><span class="line">        is_upload_add_hide: <span class="literal">true</span>,</span><br><span class="line">        tip_second: <span class="string">&quot;长按图片删除&quot;</span></span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="built_in">this</span>.choose_location();</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p>经过测试, 如果图片大小超过<code>4Mib</code>可能会造成微信闪退, 故加入了图片大小检测, 以提升系统的健壮性.</p>
<h4 id="上传图片和备注"><a href="#上传图片和备注" class="headerlink" title="上传图片和备注"></a>上传图片和备注</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//upload image with location and detail</span></span><br><span class="line">upload_images: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> that = <span class="built_in">this</span>;</span><br><span class="line">  <span class="comment">//check if the user is uploading another snapshot to the same point</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="built_in">this</span>.data.markers.length; i++) &#123;</span><br><span class="line">    <span class="keyword">var</span> marker = <span class="built_in">this</span>.data.markers[i];</span><br><span class="line">    <span class="keyword">if</span> (marker.openid == app.globalData.openid &amp;&amp; marker.name == <span class="built_in">this</span>.data.snapshots.name) &#123;</span><br><span class="line">      wx.showToast(&#123;</span><br><span class="line">        icon: <span class="string">&#x27;none&#x27;</span>,</span><br><span class="line">        title: <span class="string">&#x27;每位用户单个地点最多上传一张图片&#x27;</span>,</span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//check if the location is specified</span></span><br><span class="line">  <span class="keyword">if</span> (!<span class="built_in">this</span>.data.snapshots.name) &#123;</span><br><span class="line">    wx.showToast(&#123;</span><br><span class="line">      icon: <span class="string">&#x27;none&#x27;</span>,</span><br><span class="line">      title: <span class="string">&#x27;未选择位置&#x27;</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//check if the detail of snapshot is provided</span></span><br><span class="line">  <span class="keyword">if</span> (!<span class="built_in">this</span>.data.detail) &#123;</span><br><span class="line">    wx.showModal(&#123;</span><br><span class="line">      title: <span class="string">&#x27;提示&#x27;</span>,</span><br><span class="line">      content: <span class="string">&#x27;是否填写图片备注？&#x27;</span>,</span><br><span class="line">      cancelColor: <span class="string">&#x27;gray&#x27;</span>,</span><br><span class="line">      cancelText: <span class="string">&#x27;否&#x27;</span>,</span><br><span class="line">      confirmText: <span class="string">&#x27;是&#x27;</span>,</span><br><span class="line">      complete: <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (e.cancel) &#123;</span><br><span class="line">          wx.showModal(&#123;</span><br><span class="line">            title: <span class="string">&#x27;提示&#x27;</span>,</span><br><span class="line">            content: <span class="string">&#x27;确认上传该照片到&#x27;</span> + that.data.snapshots.name + <span class="string">&quot;？&quot;</span>,</span><br><span class="line">            cancelText: <span class="string">&#x27;取消&#x27;</span>,</span><br><span class="line">            confirmText: <span class="string">&#x27;确认&#x27;</span>,</span><br><span class="line">            success: <span class="function"><span class="keyword">function</span> (<span class="params">res</span>) </span>&#123;</span><br><span class="line">              <span class="keyword">if</span> (res.cancel) &#123;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">              &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                that.upload_image_final();</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    wx.showModal(&#123;</span><br><span class="line">      title: <span class="string">&#x27;提示&#x27;</span>,</span><br><span class="line">      content: <span class="string">&#x27;确认上传该照片到&#x27;</span> + that.data.snapshots.name + <span class="string">&quot;？&quot;</span>,</span><br><span class="line">      cancelText: <span class="string">&#x27;取消&#x27;</span>,</span><br><span class="line">      confirmText: <span class="string">&#x27;确认&#x27;</span>,</span><br><span class="line">      success: <span class="function"><span class="keyword">function</span> (<span class="params">res</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (res.cancel) &#123;</span><br><span class="line">          <span class="keyword">return</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          that.upload_image_final();</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<h4 id="上传数据"><a href="#上传数据" class="headerlink" title="上传数据"></a>上传数据</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line">upload_image_final: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    wx.showNavigationBarLoading(&#123;</span><br><span class="line">      complete: <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;&#125;,</span><br><span class="line">    &#125;)</span><br><span class="line">    wx.showToast(&#123;</span><br><span class="line">      title: <span class="string">&#x27;图片上传中&#x27;</span>,</span><br><span class="line">      icon: <span class="string">&#x27;loading&#x27;</span>,</span><br><span class="line">      duration: <span class="number">5000</span></span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">var</span> that = <span class="built_in">this</span>;</span><br><span class="line">    <span class="keyword">const</span> filePath = that.data.files[<span class="number">0</span>];</span><br><span class="line">    <span class="comment">//const filePath = files[i];</span></span><br><span class="line">    <span class="comment">//use this when uploading mutiple details</span></span><br><span class="line">    <span class="keyword">const</span> cloudPath = <span class="string">`events/<span class="subst">$&#123;that.data.event.name&#125;</span>/<span class="subst">$&#123;app.globalData.user.nickname&#125;</span>/<span class="subst">$&#123;app.globalData.openid&#125;</span>_<span class="subst">$&#123;<span class="built_in">Math</span>.random()&#125;</span>_<span class="subst">$&#123;<span class="built_in">Date</span>.now()&#125;</span>.<span class="subst">$&#123;filePath.match(<span class="regexp">/\.(\w+)$/</span>)[<span class="number">1</span>]&#125;</span>`</span>;</span><br><span class="line">    wx.cloud.uploadFile(&#123;</span><br><span class="line">      cloudPath,</span><br><span class="line">      filePath,</span><br><span class="line">      success: <span class="function"><span class="keyword">function</span> (<span class="params">res</span>) </span>&#123;</span><br><span class="line">        files_cloud_url = res.fileID;</span><br><span class="line">        that.setData(&#123;</span><br><span class="line">          files_cloud_url: files_cloud_url</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="keyword">var</span> snapshots = that.data.snapshots;</span><br><span class="line">        <span class="comment">//regenerate detail</span></span><br><span class="line">        <span class="keyword">if</span> (that.data.detail != <span class="string">&quot;暂无描述&quot;</span> &amp;&amp; that.data.detail != <span class="string">&quot;&quot;</span>) &#123;</span><br><span class="line">          snapshots.detail = that.data.detail;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          snapshots.detail = <span class="string">&quot;暂无描述&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">console</span>.log(snapshots);</span><br><span class="line">        <span class="comment">//add url field</span></span><br><span class="line">        snapshots.url = that.data.files_cloud_url;</span><br><span class="line">        <span class="keyword">var</span> e = that.data.event_shots;</span><br><span class="line">        e.push(snapshots);</span><br><span class="line">        <span class="keyword">var</span> snapshots_count = e.length;</span><br><span class="line">        that.setData(&#123;</span><br><span class="line">          event_shots: e</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="built_in">console</span>.log(that.data.event_shots);</span><br><span class="line">        wx.cloud.callFunction(&#123;</span><br><span class="line">          name: <span class="string">&#x27;update_snapshots_count&#x27;</span>,</span><br><span class="line">          data: &#123;</span><br><span class="line">            taskId: that.data.event_id.toString(),</span><br><span class="line">            my_snapshot_count: snapshots_count</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">        wx.cloud.callFunction(&#123;</span><br><span class="line">          name: <span class="string">&#x27;update_snapshots&#x27;</span>,</span><br><span class="line">          data: &#123;</span><br><span class="line">            taskId: that.data.event_id.toString(),</span><br><span class="line">            my_snapshot: that.data.event_shots,</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;).then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">          wx.hideNavigationBarLoading(&#123;</span><br><span class="line">            complete: <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;&#125;,</span><br><span class="line">          &#125;)</span><br><span class="line">          wx.showToast(&#123;</span><br><span class="line">            title: <span class="string">&#x27;上传成功&#x27;</span>,</span><br><span class="line">            duration: <span class="number">3000</span>,</span><br><span class="line">            success(res) &#123;</span><br><span class="line">              wx.pageScrollTo(&#123;</span><br><span class="line">                scrollTop: <span class="number">0</span>,</span><br><span class="line">              &#125;)</span><br><span class="line">              <span class="built_in">setTimeout</span>(that.onLoad, <span class="number">3000</span>);</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>对于图像的云储存, 我们使用将文件上传到存储区并维护链接表及链接表个数统计的方案.</p>
<p>下文的代码为云上文件存储路径的命名规则, 以及存储区的文件组织架构</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> cloudPath = `events/$&#123;that.data.event.name&#125;/$&#123;app.globalData.user.nickname&#125;/$&#123;app.globalData.openid&#125;_$&#123;Math.random()&#125;_$&#123;Date.now()&#125;.$&#123;filePath.match(/\.(\w+)$/)[<span class="number">1</span>]&#125;`;</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@12.15.17/img/HYAH/eventpic1.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@12.15.17/img/HYAH/eventpic1.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="数据库中相关数据存储架构 /event.name/"><br><img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@12.15.17/img/HYAH/eventpic2.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@12.15.17/img/HYAH/eventpic2.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="数据库中相关数据存储架构 /event.name/user.nickname/"></p>
<h4 id="cloudFunction-update-snapshots-count"><a href="#cloudFunction-update-snapshots-count" class="headerlink" title="cloudFunction update_snapshots_count"></a>cloudFunction <code>update_snapshots_count</code></h4><p><code>update_snapshots_count</code>及<code>update_snapshots</code>用来更新数据库中图片<code>counter</code>及图片表.</p>
<p><img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@12.15.17/img/HYAH/snapshot.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@12.15.17/img/HYAH/snapshot.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="数据库中相关内容"></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">exports.main = async (event, context) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> await <span class="keyword">new</span> Promise((resolve, reject) =&gt; &#123;</span><br><span class="line">    db.collection(&#x27;events&#x27;).doc(event.taskId).update(&#123;</span><br><span class="line">      data: &#123;</span><br><span class="line">        snapshots_count: event.my_snapshot_count</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;).then(console.<span class="built_in">log</span>(<span class="string">&quot;[update_snapshots][updated successfully]&quot;</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="cloudFunction-update-snapshots"><a href="#cloudFunction-update-snapshots" class="headerlink" title="cloudFunction update_snapshots"></a>cloudFunction <code>update_snapshots</code></h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">exports.main = async (event, context) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> await <span class="keyword">new</span> Promise((resolve, reject) =&gt; &#123;</span><br><span class="line">    db.collection(&#x27;events&#x27;).doc(event.taskId).update(&#123;</span><br><span class="line">      data: &#123;</span><br><span class="line">        snapshots: event.my_snapshot</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;).then(console.<span class="built_in">log</span>(<span class="string">&quot;[update_snapshots][updated successfully]&quot;</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="项目展示"><a href="#项目展示" class="headerlink" title="项目展示"></a>项目展示</h2><div class="note warning red"><p>警告: 由于小程序基本功能需要后台支持 请不要下载源码自行编译体验.</p></div>

<div class="note info blue"><p>提示: 文档中内容只有主要功能部分 如需详细讲解请联系<a href="https://brynhild.online/aboutme/">我</a>.</p></div>

<ul>
<li>Arduino代码: <a target="_blank" rel="noopener" href="https://github.com/novaELLIAS/HongYanAsstHardware">HongYanAsstHardware</a></li>
<li>微信小程序代码: <a target="_blank" rel="noopener" href="https://github.com/TheWayForward/HongyanAsst.">HongyanAsst.</a></li>
<li>微信小程序在线展示:<img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.15.1/img/HYAH/gh_c7de51796504_3441.jpg" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.15.1/img/HYAH/gh_c7de51796504_3441.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" weidth="100" height = "100" alt="QRcode" align=center /></li>
<li>宣传视频: <a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1Ca4y1W78n">bilibili</a></li>
</ul>
<p><br><iframe src="//player.bilibili.com/player.html?aid=670551213&bvid=BV1Ca4y1W78n&cid=264590611&page=1" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true"></iframe></p>
<h2 id="团队进度"><a href="#团队进度" class="headerlink" title="团队进度"></a>团队进度</h2><h3 id="开发进度"><a href="#开发进度" class="headerlink" title="开发进度"></a>开发进度</h3><table>
<thead>
<tr>
<th>项目</th>
<th>开发进度</th>
<th>迭代进度</th>
</tr>
</thead>
<tbody><tr>
<td>Arduino</td>
<td><font color=green><strong>100%</strong></font></td>
<td><font color=green><strong>100%</strong></font></td>
</tr>
<tr>
<td>微信小程序</td>
<td><font color=green><strong>100%</strong></font></td>
<td><font color=green><strong>100%</strong></font></td>
</tr>
</tbody></table>
<h3 id="组员进度"><a href="#组员进度" class="headerlink" title="组员进度"></a>组员进度</h3><blockquote>
<p>请注意对照火花空间相关内容.</p>
</blockquote>
<table>
<thead>
<tr>
<th>成员</th>
<th>团队分工</th>
<th>开发进度</th>
<th>贡献率</th>
</tr>
</thead>
<tbody><tr>
<td>ElliasK</td>
<td>所有模块的初始开发、迭代开发和调试</td>
<td><strong>100%</strong></td>
<td><strong>90%</strong></td>
</tr>
<tr>
<td>Picaloe</td>
<td>设备调试协力、影视协力、文案协力</td>
<td><strong>100%</strong></td>
<td><strong>10%</strong></td>
</tr>
</tbody></table>
<h3 id="统计数据"><a href="#统计数据" class="headerlink" title="统计数据"></a>统计数据</h3><h4 id="硬件端"><a href="#硬件端" class="headerlink" title="硬件端"></a>硬件端</h4><p><img src="https://img.shields.io/github/repo-size/novaELLIAS/HongYanAsstHardware?label=repo size" class="lazyload" data-srcset="https://img.shields.io/github/repo-size/novaELLIAS/HongYanAsstHardware?label=repo size" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="GitHub repo size" /> <img src="https://img.shields.io/github/commit-activity/m/novaELLIAS/HongYanAsstHardware" class="lazyload" data-srcset="https://img.shields.io/github/commit-activity/m/novaELLIAS/HongYanAsstHardware" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="GitHub commit activity" /></p>
<h4 id="软件端"><a href="#软件端" class="headerlink" title="软件端"></a>软件端</h4><p><img src="https://img.shields.io/github/repo-size/TheWayForward/HongyanAsst.?label=repo size" class="lazyload" data-srcset="https://img.shields.io/github/repo-size/TheWayForward/HongyanAsst.?label=repo size" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="GitHub repo size" /> <img src="https://img.shields.io/github/commit-activity/m/TheWayForward/HongyanAsst." class="lazyload" data-srcset="https://img.shields.io/github/commit-activity/m/TheWayForward/HongyanAsst." srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="GitHub commit activity" /></p>
<h3 id="调试日志"><a href="#调试日志" class="headerlink" title="调试日志"></a>调试日志</h3><div class="timenode"><div class="meta"><p><p>2020/11/16 校内 户外调试</p>
</p></div><div class="body"><p>机型: <code>v0.0-pre</code> 原型机前体 <code>HYAsst THE ORIGIN de pre-release</code></p><table><thead><tr><th>调试项目</th><th>调试结果</th></tr></thead><tbody><tr><td><code>GPS</code>精度测试</td><td><font color=green><strong>通过(WG-84标准)</strong></font></td></tr><tr><td><code>WG-84</code>转<code>GCJ-02</code>黑箱结果测试</td><td><font color=orange><strong>基本拟合, 部分点位有10m以上的精度误差</strong></font></td></tr><tr><td>基础便携性测试</td><td><font color=green><strong>通过</strong></font></td></tr><tr><td>系统稳定性测试 (<code>ESP8266</code>方案)</td><td><font color=green><strong>通过</strong></font></td></tr><tr><td><code>ESP8266</code>通信能力测试</td><td><font color=green><strong>通过, 全时连接</strong></font></td></tr></tbody></table></div></div>

<div class="timenode"><div class="meta"><p><p>2020/11/18 寝室 黑箱算法结论验证</p>
</p></div><div class="body"><table><thead><tr><th>测试项目</th><th>测试结果</th></tr></thead><tbody><tr><td><code>WG-84</code>转<code>GCJ-02</code>黑箱结果测试 <strong>(二周目)</strong></td><td><font color=red><strong>部分点位漂得厉害. 厄厄, 太野蛮了</strong></font></td></tr></tbody></table></div></div>

<div class="timenode"><div class="meta"><p><p>2020/11/20 居庸关 长途奔袭调试</p>
</p></div><div class="body"><p>机型: <code>v0.0-pre</code> 原型机前体 <code>HYAsst THE ORIGIN de pre-release</code></p><table><thead><tr><th>调试项目</th><th>调试结果</th></tr></thead><tbody><tr><td><code>ESP8266</code>移动中通信能力测试</td><td><font color=green><strong>通过, 全时连接</strong></font></td></tr><tr><td>高速便携性测试</td><td><font color=green><strong>通过</strong></font></td></tr></tbody></table><details ><summary> <p>Photos</p> </summary>              <div class='content'>              <p><img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.15.13/img/HYAH/20201120_132321.jpg" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.15.13/img/HYAH/20201120_132321.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="发车前"><br><img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.15.13/img/HYAH/20201120_151747.jpg" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.15.13/img/HYAH/20201120_151747.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="居庸关"><br><img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.15.13/img/HYAH/20201120_151832.jpg" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.15.13/img/HYAH/20201120_151832.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="居庸关"></p>              </div>            </details></div></div>

<div class="timenode"><div class="meta"><p><p>2020/11/22 蟒山 户外调试</p>
</p></div><div class="body"><p>机型: <code>v0.0-pre</code> 原型机前体 <code>HYAsst THE ORIGIN de pre-release</code></p><table><thead><tr><th>调试项目</th><th>调试结果</th></tr></thead><tbody><tr><td><code>ESP8266</code>移动中通信能力测试</td><td><font color=green><strong>通过, 全时连接</strong></font></td></tr><tr><td>高速便携性测试</td><td><font color=green><strong>通过</strong></font></td></tr><tr><td>恶劣路面便携性测试</td><td><font color=red><strong>未通过, 有杜邦线松动</strong></font></td></tr><tr><td>系统稳定性测试 (<code>ESP8266</code>方案) <strong>(二周目)</strong></td><td><font color=orange><strong>检测到的死机一次, 原因不明</strong></font></td></tr><tr><td>骑行中陀螺仪数据采集</td><td><font color=green><strong>success</strong></font></td></tr></tbody></table><details ><summary> <p>Photos</p> </summary>              <div class='content'>              <p><img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.15.3/img/HYAH/mmexport1606278218069.jpg" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.15.3/img/HYAH/mmexport1606278218069.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="蟒山脚下合照"></p>              </div>            </details></div></div>

<div class="timenode"><div class="meta"><p><p>2020/11/25-27 寝室 室内续航测试</p>
</p></div><div class="body"><p>机型: <code>v0.1</code> 初代机 <code>ASKR YGGDRASILLS</code></p><table><thead><tr><th>调试项目</th><th>调试结果</th></tr></thead><tbody><tr><td><code>ESP8266</code>方案续航测试 (900mAh)</td><td><font color=green><strong>113min, 续航良好</strong></font></td></tr><tr><td>系统稳定性测试 (<code>ESP8266</code>方案) <strong>(三周目)</strong></td><td><font color=red><strong>检测到的死机一次, 原因为<code>ESP8266</code>的<code>TCP</code>释放失败</strong></font></td></tr><tr><td><code>SIM800C</code>方案续航测试 (900mAh)</td><td><font color=green><strong>185min, 续航良好</strong></font></td></tr><tr><td>系统稳定性测试 (<code>SIM800C</code>方案)</td><td><font color=red><strong>在进行<code>TCP</code>通信时触发事故告警会死机, 需要断电重启.</strong></font></td></tr></tbody></table><ul><li>理想最大电源solution: <code>6500mAh</code>, 可提供最大电源solution: <code>30Ah</code></li><li>奇怪的事情发生了, <code>SIM800C</code>续航比<code>ESP8266</code>还长(未曾设想的道路).</li></ul><div class="note bug red"><p><strong><font color=green>[FIXED]</font></strong> <code>SIM800C</code>在进行<code>TCP</code>通信时触发事故告警会死机</p></div></div></div>

<div class="timenode"><div class="meta"><p><p>2020/11/28 校内 户外调试</p>
</p></div><div class="body"><p>机型: <code>v0.1</code> 初代机 <code>ASKR YGGDRASILLS</code></p><div class="note notice"><p>从此次开始所有的系统稳定性测试默认为<code>SIM800C</code>方案.</p></div><table><thead><tr><th>调试项目</th><th>调试结果</th></tr></thead><tbody><tr><td><code>SIM800C</code>通信能力测试</td><td><font color=green><strong>通过, 全时连接</strong></font></td></tr><tr><td>精确的<code>WG-84 to GCJ-02</code>公式验证</td><td><font color=green><strong>通过</strong></font></td></tr><tr><td><code>GPS</code>速度精度测试</td><td><font color=green><strong>通过, 测得误差约为±0.092kmph</strong></font></td></tr><tr><td>事故侦测算法及参数验证 <strong>(二周目)</strong></td><td><font color=green><strong>通过, 判断准确</strong></font></td></tr><tr><td>基础便携性测试 <strong>(二周目)</strong></td><td><font color=green><strong>通过</strong></font></td></tr><tr><td>高速便携性测试 <strong>(二周目)</strong></td><td><font color=green><strong>通过</strong></font></td></tr><tr><td>恶劣路面便携性测试 <strong>(二周目)</strong></td><td><font color=green><strong>通过</strong></font></td></tr><tr><td>系统稳定性测试 <strong>(二周目)</strong></td><td><font color=green><strong>通过</strong></font></td></tr></tbody></table><div class="note bug red"><p><strong><font color=green>[FIXED]</font></strong> 微信小程序中当前点标注由于图片中心点问题在画布缩小后看起来定位不准</p></div><div class="note bug red"><p><strong><font color=green>[FIXED]</font></strong> <code>timer = setInterval</code>失效 只能手动刷新</p></div><details ><summary> <p>Photos</p> </summary>              <div class='content'>              <p><img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.15.5/img/HYAH/ts2.2.jpg" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.15.5/img/HYAH/ts2.2.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="调试工具人: 移动电脑架"><br><img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.15.5/img/HYAH/ts2.1.jpg" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.15.5/img/HYAH/ts2.1.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="桶上调试"></p>              </div>            </details></div></div>

<div class="timenode"><div class="meta"><p><p>2020/12/06 校内 户外调试</p>
</p></div><div class="body"><p>机型: 三代目: <code>RAMIEL OCTAHEDRON</code></p><table><thead><tr><th>调试项目</th><th>调试结果</th></tr></thead><tbody><tr><td>事故侦测算法及参数验证 <strong>(三周目)</strong></td><td><font color=green><strong>通过, 判断准确</strong></font></td></tr><tr><td>高速便携性测试 <strong>(三周目)</strong></td><td><font color=green><strong>通过</strong></font></td></tr><tr><td>恶劣路面便携性测试 <strong>(三周目)</strong></td><td><font color=green><strong>通过</strong></font></td></tr><tr><td>系统稳定性测试</td><td><font color=green><strong>通过</strong></font></td></tr><tr><td>整体通信能力测试</td><td><font color=green><strong>通过, 全时连接</strong></font></td></tr><tr><td>续航测试 (900mAh) <strong>(二周目)</strong></td><td><font color=green><strong>203min, 续航良好</strong></font></td></tr><tr><td>系统稳定性测试 <strong>(三周目)</strong></td><td><font color=green><strong>通过</strong></font></td></tr></tbody></table></div></div>

<h2 id="开发点滴"><a href="#开发点滴" class="headerlink" title="开发点滴"></a>开发点滴</h2><h3 id="音乐推荐"><a href="#音乐推荐" class="headerlink" title="音乐推荐"></a>音乐推荐</h3><p><img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.15.3/img/HYAH/theGardenOfSinners.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.15.3/img/HYAH/theGardenOfSinners.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" weidth="200" height = "200" alt="[梶浦由記] the Garden of sinners -劇場版 空の境界 音楽集-" align=center /> <br></p>
<img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.15.3/img/HYAH/GSD.jpg" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.15.3/img/HYAH/GSD.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" weidth="200" height = "200" alt="[London Symphony Orchestra] 交響組曲 機動戦士ガンダムSEED DESTINY Symphony SEED DESTINY" align=center />

<h3 id="电子熏香"><a href="#电子熏香" class="headerlink" title="电子熏香"></a>电子熏香</h3><p>2020年11月20日早晨6点25分, 由于没睡醒进行了一些奇妙操作导致SIM800C冒烟. <font color=gray><strong>R.I.P.</strong></font></p>
<img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.15.3/img/HYAH/20201121_152617.jpg" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.15.3/img/HYAH/20201121_152617.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" weidth="300" height = "400" alt="去世的SIM800C" align=center />

<p>从此我组给部分硬件损毁的情况起了别名:</p>
<table>
<thead>
<tr>
<th>别名</th>
<th>实际故障</th>
</tr>
</thead>
<tbody><tr>
<td>放炮</td>
<td>炸电解电容/二极管</td>
</tr>
<tr>
<td>电子熏香</td>
<td>板子糊了</td>
</tr>
<tr>
<td>核爆</td>
<td>炸电源</td>
</tr>
</tbody></table>
<h3 id="噜"><a href="#噜" class="headerlink" title="噜"></a>噜</h3><p><img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.15.11/img/HYAH/atlu.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.15.11/img/HYAH/atlu.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="支離滅裂な思考と発言"></p>
<h3 id="Apple-punch"><a href="#Apple-punch" class="headerlink" title="Apple punch"></a>Apple punch</h3><p>🍎砸牛顿, 于是有了万有引力定律.</p>
<p>🍎砸我们, 于是弯了电容和杜邦线.</p>
<details ><summary> <p>事故现场</p> </summary>
              <div class='content'>
              <p><img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.15.3/img/HYAH/20201121_210318.jpg" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.15.3/img/HYAH/20201121_210318.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="🍎惨剧"><br><img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.15.3/img/HYAH/20201121_210354.jpg" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.15.3/img/HYAH/20201121_210354.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="🍎惨剧"></p>
              </div>
            </details>

<h2 id="团队故事"><a href="#团队故事" class="headerlink" title="团队故事"></a>团队故事</h2><h3 id="Picaloe"><a href="#Picaloe" class="headerlink" title="Picaloe"></a>Picaloe</h3><blockquote>
<p>首先非常有幸能与我们小组组长一同完成本次大作业，本人是一个完全技术上的萌新小白，但与一个拥有过硬技术的组长共同完成了这个我认为很完美的项目，过程中我体会到了完成一个项目的难度，技术掌握，项目规划，文案策划等等，组长很早就已经开始策划本次大作业的方向了，由于本人技术原因，在技术创新方面我出力甚少，但在文案策划排版方面，我学到了许多新知识，例如<code>LaTeX</code>，<code>html</code>一些的文本代码的编写与格式的实现。我想说，这个项目，无论在，硬件，软件，还是文案布局方面，都付出了极大的心血，组长打代码的声音我是忘不了了。这次项目下来，我认识到了小组合作的重要性，也初步加深了对这个专业作为工科的理解，希望今后能慢慢从一只萌新小白成长为一位老打工人。</p>
</blockquote>
<h3 id="ElliasK"><a href="#ElliasK" class="headerlink" title="ElliasK"></a>ElliasK</h3><p><img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/HYAH/summery/1.jpg" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/HYAH/summery/1.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" weidth="200" height = "200" align=center /> <br></p>
<p><img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/HYAH/summery/2.jpg" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/HYAH/summery/2.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" weidth="200" height = "213.88" align=center /> <br></p>
<blockquote>
<p>这是一次很充实、很有趣、很具有挑战性、自认为不管是过程还是效果都姑且认为可以令人满意的大作业。</p>
</blockquote>
<p>首先，在项目初期元认知和项目初期思维层面就具有一定的挑战。我们从用户的角度出发，积极运用课内所体悟到的元认知的相关内容，在分析用户需求、确定产品定位等方面深刻体悟到了元认知对于项目初期项目确立的重要意义。我们不但应用了课内所学的元认知的内容，还对课内的知识进行了进一步的扩展，在本次项目的实践中，发现我最初的胡思乱想是有效果的，是对实践有指导意义的。这个创新便是<code>Q&amp;A</code>部分（在次文档的开头有这一部分的简单举例）。我们通过一对一的用户访谈以及针对于产品功能及技术实现的方案公开招标，收集到了大量热心用户（特别是鸿雁自行车协会中的具有丰富骑行经验的热心车友）的质疑和建议，在分析与解答热心用户的提问或建议的同时，我们发现了项目中所存在的，不管是功能方面的还是技术实现方面的漏洞，并在项目进行的过程中进行调整，使得我们的项目尽可能的完善。我们很希望这种思路可以进入信息与通信工程导论课程元认知教学的内容中，旨在增强需求分析能力、促进研发交流、提升社区活力，为更多优秀作品的诞生垫下基石。</p>
<p>得益于项目初期科学理论的指导以及热心用户的帮助，我自认为我们的项目具有创新性与实用性。创新性无需多言：面向广大骑行组织以及个人的，能够结合实时监测、事故侦测、信息共享的，便于携带且造价低廉的，端到端的，软硬结合的骑行安全监控系统是史无前例的。对于实用性，通勤时马路交通的复杂性、竞赛或日常训练高速骑行的危险性是众所周知的，以地图为画板进行图片共享是将图片与位置结合的最好手段，实时定位以及小程序中所开发的其他功能项目对于自行车协会运营的简化程度也是可想而知的。正因如此，可以说，这个项目充分发挥了硬件–&gt;云&lt;–&gt;微信小程序的端到端系统的功能优势，在创新性与实用性的方面做到了能够真正解决实际问题、开辟新的道路的程度。</p>
<p>其次，在项目的研发阶段，我们应用了项目管理、科技创新管理的知识理论体系，在<code>PMBOK</code>、<code>PRINCEⅡ</code>等专业化项目管理理论体系，有效地做到了一下几点指标：</p>
<ol>
<li><p><strong>人尽其力。</strong> 我们的小组成员实力参差不齐，我作为组长，自认为拥有较强的组织领带和项目经理能力，并且不管是基础的代码编写、焊接、视频制作、文档撰写，还是比较高等的算法设计及应用、数据结构设计及应用、元认知、项目开发思维，相比与组员都有得天独厚的优势，所以贡献主要在项目开发和迭代过程中。对于技术力较弱的队友，因其有摄影的爱好，便承担了展示视频制作中的素材采集工作，在开发和调试过程中所担任的后勤保障的工作也极为重要。在开发的过程中，我们分工明确，配合默契，比起我单打独斗，效率的确有显著提升，项目开发体验明显改善，营造了一种清新愉快的和睦气氛。</p>
</li>
<li><p><strong>指标动态化。</strong> 众所周知，项目的目标并不完全是从项目的开始就定好的，由于项目干系人（在此次项目中，项目干系人大多为<code>Q&amp;A</code>体系中的热心用户，特别是车协中心组活动部的成员以及在项目开发方面有深刻见解的学长）需求的不断变化，开发进程中对技术把握的更新，在开发进程中发现的项目的问题的解决，导致项目的目标及技术实现等指标不断变化。在诸多变化之中，我们积极应对，应用<code>DDP</code>（动态动态规划）的思想，在每一次状态转移中都尽力保持能够达到最终结果的最优解的状态，从而在各种层面上保证了产品的完整性和完成度。</p>
</li>
<li><p><strong>物尽其用。</strong> 得益于科技创新理论体系的指引，我们在对技术手段的选取上可谓是好不冗余，物尽其用。我们对应于每一个需求所采取的技术手段都是经过深思熟虑的，使得功能实现的技术开销能够维持在较低的水平。例如，我们之所以要做端到端系统，并不是像某些同年级项目一样只是为了得到更高的项目复杂度，进而得到更高的分数，我们采取端到端的理由是因为端到端系统真的是我们的刚需，是我们无法回避的。如果我们的项目可以不使用端到端系统，能够使用更简单的、实现代价更低的系统就可以完成，并且其性能没有过大损失的话，我们舍弃端到端便是理所应当之事。对于<code>WG-84 to GCJ-02</code>制式转换，我们最开始采取模拟退火（莫得深度）进行黑箱测试，可以得到基本满足使用精度的可行解；但是经过后来的测试，我们发现在一些奇怪的点位上我们得出的解有明显的偏移，于是我们果断使用数学方法，最终得出了精准的解决方案。对于事故侦测中对一定时间内采集到的数据的均值的维护，采取了被广泛认同是最佳方案的循环数组的方案，能够在尽可能节省空间的前提下实现功能。对于数据库内容的更新，我们直接采取了云函数的方式。尽可能使用较为简单便捷的技术方案，不管是在开发过程中的代价问题，还是在使用过程中的资源占用以及健壮性问题，尽量使用简单便捷的技术方案是有其现实意义的，是项目开发过程中所必须追求的。这是项目思维的体现，是对对技术的精准掌握的体现，是对项目本身指标熟悉程度的体现，是对用户的尊重的体现，是项目工程师或项目经理对自身技术能力以及元认知能力的极佳彰显。</p>
</li>
</ol>
<p>第三，在迭代过程中，有了前两步的积累（特别是<code>Q&amp;A</code>模块产生的反馈），我们在实现基础功能之后，在迭代过程中应该选取的方向已经很明确了。对于一个在移动场景中使用的产品，我们充分注重了产品的便携性（包括形状，大小，重量，坚固程度）以及续航，虽然便携性结果并不太令人满意，由于时间的限制我们预测我们的印刷电路板无法及时到货，我们所有的设备（除了集信息显示、电源接入、电路稳定、线材收束、开关控制等功能为一体的我花了将近两天晚上来设计和焊接的大小仅有<code>4x6cm</code>的我也不知道到底应该叫什么的洞洞板之外）基本停留在公版方案上，虽然使用铜柱将所有板子固定，并且将杂乱无章的线材收束起来，再用大排线接到<code>arduino</code>板上（上文提到的我也不知道到底应该叫什么的洞洞板其实是双面焊接，背面也有排针（焊得我险些去世（不是））（硬件连接中有展示图片），整个产品的便携性也是可以保证的。在续航方面，我们取得了在常规工况下长达<code>23</code>小时的优秀的续航成绩，以至于我们因此取消了本来打算实装的睡眠方案，改而采取优化发包频率的策略。正是由于我们在前期充分重视元认知和用户反馈，我们在迭代时有充足的抓手，能够快且精准地找到方向，使迭代过程顺利进行。</p>
<p>最后，在项目收尾过程（包括项目文档撰写、展示视频制作等）中，由于前期项目进行过程中的良好习惯，收尾进程也进行地尤为顺利。在此次项目开发的过程中，我充分意识到了一个完全的项目的最基本要求其中的几条就是元认知、项目开发思维、项目管理思维、科技创新管理思维的始终贯彻，良好开发习惯的始终保持。感谢这次大作业让我在大学的第一个学期里拥有了一段愉快的、难以忘怀的记忆，进一步促进了我对项目开发的热爱。这依然成为我记忆宝库中为数不多的珍宝，将伴随着我度过从今以后的岁月。</p>
<details ><summary> <p>室外调试过程中拍的照片中的几张</p> </summary>
              <div class='content'>
              <p><img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.15.12/img/HYAH/20201108_150643.jpg" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.15.12/img/HYAH/20201108_150643.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="十三陵水库"><br><img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.15.12/img/HYAH/20201120_151832.jpg" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.15.12/img/HYAH/20201120_151832.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="居庸关"><br><img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.15.12/img/HYAH/20201108_140405.jpg" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.15.12/img/HYAH/20201108_140405.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="京藏高速"></p>
              </div>
            </details>

<h2 id="Next-Dream-2020-12-07"><a href="#Next-Dream-2020-12-07" class="headerlink" title="Next Dream.. @2020.12.07"></a>Next Dream.. @2020.12.07</h2><p>进一步迭代前景展望</p>
<ol>
<li>性能更强功耗更低成本更低的<code>MCU</code>. 目前计划使用<code>STM32</code>进行进一步开发.</li>
<li>更好的通信功耗及性能. 目前计划改用<code>NB-IoT</code>模块, 使用<code>CoAP</code>协议.</li>
<li>更美的外观, 更高的便携性, 更好的电气性能. 计划绘制并印刷电路板, 完成各项设备的集成化.</li>
<li>更好的软件优化. 重构硬件代码, 码风更为清秀、封装性更强的同时充分考虑各种使用场景, 力求性能和功耗平衡的最优解.</li>
<li>微信小程序代码性能进一步优化, 注重代码性能和效率.</li>
<li>继续完善微信小程序周边功能, 比如用户注册时的短信验证码, 个人信息修改等等.</li>
</ol>
<blockquote>
<p>Dream never eclipses. We are always on the way forward.</p>
</blockquote>
<h2 id="Recerence"><a href="#Recerence" class="headerlink" title="Recerence"></a>Recerence</h2><blockquote>
<p><code>TheWayForward</code></p>
<p><a target="_blank" rel="noopener" href="http://faioj.brynhild.online/cppreference/">FAIOJ C++参考手册</a></p>
<p><a target="_blank" rel="noopener" href="https://www.zhihu.com/question/55648210">已知不可逆的坐标转换算法，通过结果进行反算的方法</a></p>
<p><a target="_blank" rel="noopener" href="https://www.w3cschool.cn/ecmascript/3uge1q5v.html">w3school ECMAScript 6 Promise对象</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/langzou/p/10402501.html">GCJ-02到WG-84坐标变换</a></p>
<p><a target="_blank" rel="noopener" href="https://wenku.baidu.com/view/8928d61402768e9951e73889.html">百度文库 NEO-7_ProductSummary_(GPS.G7-HW-11003)</a></p>
<p><a target="_blank" rel="noopener" href="http://bilgin.esme.org/BitsAndBytes/KalmanFilterforDummies">KalmanFilterforDummies</a></p>
<p><a target="_blank" rel="noopener" href="https://www.intechopen.com/books/introduction-and-implementations-of-the-kalman-filter/introduction-to-kalman-filter-and-its-applications">Introduction-and-implementations-of-the-kalman-filter</a></p>
<p><a target="_blank" rel="noopener" href="https://wenku.baidu.com/view/3ba0b673effdc8d376eeaeaad1f34693daef109d.html">百度文库 基于单片机控制的积分式电压表设计</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/fabriceo/SCoop/issues/4">SCoop Github issue about timer0_overflow_count</a></p>
<p><a target="_blank" rel="noopener" href="https://playground.arduino.cc/Main/PROGMEM/">Arduino PROGMEM</a></p>
<p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.15.4/img/HYAH/SIM800_Series_AT_Command_Manual_V1.07.pdf">SIM800 Series AT Command Manual V1.07</a></p>
<p><a target="_blank" rel="noopener" href="https://wenku.baidu.com/view/8b41ae843b3567ec102d8ae6.html">百度文库 SIM800C_硬件设计手册_V1.01</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/tech_joy/article/details/105877066">CSDN JOY_TECH SIM800C的使用心得</a></p>
<p><a target="_blank" rel="noopener" href="https://wenku.baidu.com/view/a7492aeab9f3f90f76c61b8d.html">百度文库 MPU6050 技术手册</a></p>
<p><a target="_blank" rel="noopener" href="https://developers.weixin.qq.com/miniprogram/dev/framework/">微信小程序文档 - 微信开放文档</a></p>
<p><a target="_blank" rel="noopener" href="https://www.arduino.cc/en/Tutorial/HomePage">Arduino tutorials</a></p>
<p><a target="_blank" rel="noopener" href="https://www.arduino.cc/en/Tutorial/BuiltInExamples/ArduinoISP">ArduinoISP</a></p>
<p><a target="_blank" rel="noopener" href="https://www.latex-project.org/">The LaTeX Project</a></p>
<p><a target="_blank" rel="noopener" href="http://www.ctex.org/onlinedocuments">CTEX : OnlineDocuments LaTeX</a></p>
<p><a target="_blank" rel="noopener" href="http://www.ctex.org/documents/latex/latex2e-html/index.html">Hypertext Help with LaTeX</a></p>
<p><a target="_blank" rel="noopener" href="http://www.ctex.org/documents/latex/graphics/index.html">LATEX2e 插图指南</a></p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/166219554">编译原理——链接过程</a></p>
<p><a target="_blank" rel="noopener" href="https://open.iot.10086.cn/devdoc/">OneNET 文档中心</a></p>
<p><a target="_blank" rel="noopener" href="https://open.iot.10086.cn/doc/multiprotocol/">OneNET 多协议接入</a></p>
<p><a target="_blank" rel="noopener" href="https://www.pianshen.com/article/1601187790/">程序员大本营 HTTP报文格式</a></p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/112060856">知乎 HTTP报文格式简介</a></p>
<p><a target="_blank" rel="noopener" href="http://www.cplusplus.com/reference/string/string/c_str/">std::string::c_str</a></p>
<p><a target="_blank" rel="noopener" href="https://weui.io/">WeUI 文档</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/Tencent/weui">GitHub Tencent WeUI</a></p>
<p><a target="_blank" rel="noopener" href="https://jin-yufeng.github.io/Parser/#/">Parser富文本插件 文档</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/jin-yufeng/Parser">GitHub jin-yufeng Parser</a></p>
</blockquote>

  
  
    
    <div class='footer'>
      
      
      
        <div class='copyright'>
          <blockquote>
            
              
                <p>内容遵循 <a href="%22https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en%22">Attribution-NonCommercial-ShareAlike 4.0 International (CC BY-NC-SA 4.0) License</a>.</p>

              
            
              
                <p>本文永久链接：<a href=https://brynhild.online/HongYanAsstHard/>https://brynhild.online/HongYanAsstHard/</a></p>
              
            
          </blockquote>
        </div>
      
      
        <div class='donate'>
          <div class='imgs'>
            
              <img src='https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/reward/qq_pic_merged_1581578634684.jpg'>
            
              <img src='https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.4.2/img/reward/wepay-2-e1541232487203.png'>
            
              <img src='https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/reward/qq_pic_merged_1581578554413.jpg'>
            
          </div>
        </div>
      
    </div>
  
  
    


  <div class='article-meta' id="bottom">
    <div class='new-meta-box'>
      
        
          <div class="new-meta-item date" itemprop="dateUpdated" datetime="2020-12-13T10:19:17+08:00">
  <a class='notlink'>
    <i class="fas fa-edit fa-fw" aria-hidden="true"></i>
    <p>Updated at Dec 13, 2020</p>
  </a>
</div>

        
      
        
          

        
      
        
          
  <div class="new-meta-item share -mob-share-list">
  <div class="-mob-share-list share-body">
    
      
        
        <div class='hoverbox'>
          <a class='share'><img src="https://cdn.jsdelivr.net/gh/volantis-x/cdn-org/logo/128/qrcode.png"></a>
          <div class='target'>
            <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAARgAAAEYCAAAAACi5bZQAAAC9klEQVR42u3aSXLDMAwEQP3/08k9S4kYQC4jad4cxxTZukwBuD6sH9eFAAwYMGDAgFkDc4Xr24Zf/n73ufr8u+dN3QcMGDBgwIABsw/mOAA1YVKA9LnV+4ABAwYMGDBg9sLcBqBicEvhnn4hYMCAAQMGDBgw3QtOBTswYMCAAQMGDJgpmO4FpgtmYMCAAQMGDJi/D1NuUBV/f3rgabCXdyLBgAEDBgwYMC+Dqa6pwPfU5/g+YMCAAQMGDJg1MN2VBrC0kZYGyuP7gAEDBgwYMGDWwKQBqVrASvd99XPAgAEDBgwYMPthqoFsKuilLyLdtzxRBQYMGDBgwIB5O5jpi3dhqgGvGjx//X8wYMCAAQMGzBqY06B3etC0sDQNmBauwIABAwYMGDD7YNKCz+nvuoWmtJBVLqCBAQMGDBgwYNbCTA32dBtqp4Bp4CwHPDBgwIABAwbM28IcF3LCBle3AJYOBFULXWDAgAEDBgyYPTBTQS5tkE0VmrovFAwYMGDAgAGzDyYNSqeA0xDd4He7HxgwYMCAAQNmLcyrA1b6Ak6By4U4MGDAgAEDBsw6mPSg6ffVRlz6YsoNQzBgwIABAwbMGpipAlFa0OruczUXGDBgwIABA2Y/TDooVB0MOg12KUT13GDAgAEDBgyYvwNTbZR1B4Wq8E814sCAAQMGDBgw+2GmLvr0YFL3/GOFKjBgwIABAwbM28GkAzhPBcRqgSs+LxgwYMCAAQNmPUxc6BkeKDo9z+lzbvcFAwYMGDBgwKyB6a6pAHh64dOC0+nzwIABAwYMGDB7Ya5wtRtbw4ExhQcDBgwYMGDA7IdJB4eeGvyZDniPNdzAgAEDBgwYMG8D0w1QaQOtGgynGm9gwIABAwYMGDDdQlUa4E7PcRw4wYABAwYMGDD/Dub0gqeFpelBo3hwCAwYMGDAgAGzBqZbcEoba92GXvriwIABAwYMGDD7YaYbV9WDdQeKqo3AX/cHAwYMGDBgwKyBscCAAQMGDBgwy9YntrTkHX15j0AAAAAASUVORK5CYII=">
          </div>
        </div>
      
    
      
        <a class="-mob-share-qq" title="" rel="external nofollow noopener noreferrer noopener"
          
          target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://brynhild.online/HongYanAsstHard/&title=HongYanAsstHardware - Next Dream...&summary=
信息与通信工程导论项目 HongYanAsst 骑行安全监控系统 Wiki

"
          
          >
          
            <img src="https://cdn.jsdelivr.net/gh/volantis-x/cdn-org/logo/128/qq.png">
          
        </a>
      
    
      
        <a class="-mob-share-qzone" title="" rel="external nofollow noopener noreferrer noopener"
          
          target="_blank" href="https://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=https://brynhild.online/HongYanAsstHard/&title=HongYanAsstHardware - Next Dream...&summary=
信息与通信工程导论项目 HongYanAsst 骑行安全监控系统 Wiki

"
          
          >
          
            <img src="https://cdn.jsdelivr.net/gh/volantis-x/cdn-org/logo/128/qzone.png">
          
        </a>
      
    
      
        <a class="-mob-share-weibo" title="" rel="external nofollow noopener noreferrer noopener"
          
          target="_blank" href="http://service.weibo.com/share/share.php?url=https://brynhild.online/HongYanAsstHard/&title=HongYanAsstHardware - Next Dream...&summary=
信息与通信工程导论项目 HongYanAsst 骑行安全监控系统 Wiki

"
          
          >
          
            <img src="https://cdn.jsdelivr.net/gh/volantis-x/cdn-org/logo/128/weibo.png">
          
        </a>
      
    
      
        <a class="-mob-share-telegram" title="" rel="external nofollow noopener noreferrer noopener"
          
            target="_blank" href="https://t.me/share/url?url=https://brynhild.online/HongYanAsstHard/&text=HongYanAsstHardware - Next Dream..."
          
          >
          
            <img src="https://cdn.jsdelivr.net/gh/volantis-x/cdn-org/logo/128/telegram.png">
          
        </a>
      
    
  </div>
</div>



        
      
    </div>
  </div>


  
  

  
    <div class="prev-next">
      
      
        <a class='next' href='/recall-oi-20200828/'>
          <p class='title'>YMOI圣地巡礼<i class="fas fa-chevron-right" aria-hidden="true"></i></p>
          <p class='content'>
2020.8.28 YMOI暑假24中集训圣地巡礼goto: ELLIAS的退役之路





罗森便利店(七七街店)2020-08-28


2018-07-25



大连市第24中学
次...</p>
        </a>
      
    </div>
  
</article>


  

  <article class="post white-box reveal shadow" id="comments">
    <p ct><i class='fas fa-comments'></i> Comments</p>
    
      <p cst>Please contact the Administrator directly for emergency.</p>
    
    <div id="valine_container" class="valine_thread">
  <i class="fas fa-cog fa-spin fa-fw fa-2x"></i>
</div>

  </article>





  <script>
  // https://github.com/theme-next/hexo-theme-next/blob/master/layout/_third-party/math/mathjax.swig
  if (typeof MathJax === 'undefined') {
    window.MathJax = {
      loader: {
        source: {
          '[tex]/amsCd': '[tex]/amscd',
          '[tex]/AMScd': '[tex]/amscd'
        }
      },
      tex: {
        inlineMath: {'[+]': [['$', '$']]},
        tags: 'ams'
      },
      options: {
        renderActions: {
          findScript: [10, doc => {
            document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
              const display = !!node.type.match(/; *mode=display/);
              const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
              const text = document.createTextNode('');
              node.parentNode.replaceChild(text, node);
              math.start = {node: text, delim: '', n: 0};
              math.end = {node: text, delim: '', n: 0};
              doc.math.push(math);
            });
          }, '', false],
          insertedScript: [200, () => {
            document.querySelectorAll('mjx-container').forEach(node => {
              let target = node.parentNode;
              if (target.nodeName.toLowerCase() === 'li') {
                target.parentNode.classList.add('has-jax');
              }
            });
          }, '', false]
        }
      }
    };
    (function () {
      var script = document.createElement('script');
      script.src = 'https://cdn.jsdelivr.net/npm/mathjax@3.0/es5/tex-mml-chtml.js';
      script.defer = true;
      document.head.appendChild(script);
    })();
  } else {
    // 文章章节标题不能为 “MathJax” ，否则会报错。
    MathJax.startup.document.state(0);
    MathJax.texReset();
    MathJax.typeset();
  }
</script>



</div>
<aside class='l_side'>
  
  
    
    



  <section class="widget toc-wrapper shadow blur desktop mobile" id="toc-div" >
    
  <header>
    
      <i class="fas fa-list fa-fw" aria-hidden="true"></i><span class='name'>INDEX</span>
    
  </header>


    <div class='content'>
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%E8%83%8C%E6%99%AF%E5%8F%8A%E7%94%A8%E6%88%B7%E5%88%86%E6%9E%90"><span class="toc-text">项目背景及用户分析</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9B%E6%84%8F%E8%BF%87%E7%A8%8B"><span class="toc-text">创意过程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E6%84%8F%E5%88%86%E6%9E%90%E8%BF%87%E7%A8%8B"><span class="toc-text">创意分析过程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%E7%9B%AE%E6%A0%87"><span class="toc-text">项目目标</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Q-amp-A"><span class="toc-text">Q&amp;A</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9D%E6%AD%A5%E5%8E%9F%E7%90%86%E8%A7%84%E5%88%92"><span class="toc-text">初步原理规划</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%BE%E5%A4%87"><span class="toc-text">设备</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BE%E5%A4%87%E5%88%97%E8%A1%A8"><span class="toc-text">设备列表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A1%AC%E4%BB%B6%E7%BB%84%E8%A3%85"><span class="toc-text">硬件组装</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8E%9F%E5%9E%8B%E6%9C%BA-HYAsst-THE-ORIGIN"><span class="toc-text">原型机: HYAsst THE ORIGIN</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9D%E4%BB%A3%E6%9C%BA-ASKR-YGGDRASILLS"><span class="toc-text">初代机: ASKR YGGDRASILLS</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BA%8C%E5%8F%B7%E6%9C%BA-SORYU-KYOKO-ZEPPELIN"><span class="toc-text">二号机: SORYU KYOKO ZEPPELIN</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BA%8C%E5%8F%B7%E6%9C%BA%C2%B7%E6%94%B9-SORYU-ASUKA-RANGURE"><span class="toc-text">二号机·改: SORYU ASUKA RANGURE</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%89%E4%BB%A3%E7%9B%AE-RAMIEL-OCTAHEDRON"><span class="toc-text">三代目: RAMIEL OCTAHEDRON</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AF%BC%E8%AE%BA%E8%AF%BE%E5%A4%A7%E4%BD%9C%E4%B8%9A%E6%88%90%E6%9E%9C-RAMIEL-FINAL"><span class="toc-text">导论课大作业成果: RAMIEL FINAL</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%88%91%E4%B9%9F%E4%B8%8D%E7%9F%A5%E9%81%93%E5%88%B0%E5%BA%95%E5%BA%94%E8%AF%A5%E5%8F%AB%E4%BB%80%E4%B9%88%E7%9A%84%E6%B4%9E%E6%B4%9E%E6%9D%BF%E5%B1%95%E7%A4%BA"><span class="toc-text">我也不知道到底应该叫什么的洞洞板展示</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#How-to-use"><span class="toc-text">How to use</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BD%AF%E4%BB%B6%E8%AE%BE%E5%AE%9A"><span class="toc-text">软件设定</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8C%87%E7%A4%BA%E7%81%AF%E4%BF%A1%E6%81%AF"><span class="toc-text">指示灯信息</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#main-board"><span class="toc-text">main board</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SIM800C"><span class="toc-text">SIM800C</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#GPS"><span class="toc-text">GPS</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#MPU6050"><span class="toc-text">MPU6050</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8A%9F%E8%83%BD%E5%AE%9E%E7%8E%B0"><span class="toc-text">功能实现</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A1%AC%E4%BB%B6"><span class="toc-text">硬件</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%B0%83%E8%AF%95%E5%B7%A5%E5%85%B7"><span class="toc-text">调试工具</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Arduino-%E5%A4%9A%E7%BA%BF%E7%A8%8B"><span class="toc-text">Arduino 多线程</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Metro-Timer"><span class="toc-text">Metro Timer</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#SCoop"><span class="toc-text">SCoop</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Kalman-Filter"><span class="toc-text">Kalman Filter</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SIM800C-%E4%BE%9B%E7%94%B5%E9%97%AE%E9%A2%98"><span class="toc-text">SIM800C 供电问题</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SIM800C%E5%8F%91%E9%80%81HTTP%E6%8A%A5%E6%96%87"><span class="toc-text">SIM800C发送HTTP报文</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SIM800C%E5%8F%91%E9%80%81%E7%9F%AD%E4%BF%A1"><span class="toc-text">SIM800C发送短信</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#LED%E7%81%AF%E6%8E%A7%E5%88%B6%E5%87%BD%E6%95%B0"><span class="toc-text">LED灯控制函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BA%A2%E5%A4%96%E9%81%A5%E6%8E%A7%E5%99%A8%E7%BC%96%E7%A0%81"><span class="toc-text">红外遥控器编码</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BA%A2%E5%A4%96%E9%81%A5%E6%8E%A7%E4%BF%A1%E6%81%AF%E5%A4%84%E7%90%86%E9%80%BB%E8%BE%91"><span class="toc-text">红外遥控信息处理逻辑</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BA%8B%E6%95%85%E4%BE%A6%E6%B5%8B"><span class="toc-text">事故侦测</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Bad-Attempt-%E5%90%91-Arduino-UNO-%E7%A7%BB%E6%A4%8D"><span class="toc-text">[Bad Attempt] 向 Arduino  UNO 移植</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%87%8F%E5%B0%8FRAM%E5%8D%A0%E7%94%A8"><span class="toc-text">减小RAM占用</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%83%A7%E5%86%99bootloader"><span class="toc-text">烧写bootloader</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F"><span class="toc-text">微信小程序</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#WG-84-to-GCJ-02-%E5%9D%90%E6%A0%87%E8%BD%AC%E6%8D%A2"><span class="toc-text">WG-84 to GCJ-02 坐标转换</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%AE%9E%E6%97%B6%E5%88%B7%E6%96%B0"><span class="toc-text">数据实时刷新</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E5%BD%93%E5%89%8Devent"><span class="toc-text">获取当前event</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%8E%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%AD%E8%8E%B7%E5%8F%96%E5%BD%93%E5%89%8Devent%E6%89%80%E5%AF%B9%E5%BA%94%E7%9A%84%E5%9B%BE%E7%89%87%E8%A1%A8"><span class="toc-text">从数据库中获取当前event所对应的图片表</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%8EOneNet%E8%8E%B7%E5%8F%96%E8%AE%BE%E5%A4%87%E4%BF%A1%E6%81%AF"><span class="toc-text">从OneNet获取设备信息</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9C%A8%E5%9C%B0%E5%9B%BE%E4%B8%8A%E7%82%B9%E5%87%BB%E5%9B%BE%E7%89%87%E7%82%B9"><span class="toc-text">在地图上点击图片点</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%98%BE%E7%A4%BA%E6%89%80%E6%9C%89%E5%9B%BE%E7%89%87"><span class="toc-text">显示所有图片</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%80%89%E6%8B%A9%E4%B8%8A%E4%BC%A0%E4%BD%8D%E7%82%B9"><span class="toc-text">选择上传位点</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%80%89%E6%8B%A9%E8%A6%81%E4%B8%8A%E4%BC%A0%E7%9A%84%E5%9B%BE%E7%89%87"><span class="toc-text">选择要上传的图片</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%8A%E4%BC%A0%E5%9B%BE%E7%89%87%E5%92%8C%E5%A4%87%E6%B3%A8"><span class="toc-text">上传图片和备注</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%8A%E4%BC%A0%E6%95%B0%E6%8D%AE"><span class="toc-text">上传数据</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#cloudFunction-update-snapshots-count"><span class="toc-text">cloudFunction update_snapshots_count</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#cloudFunction-update-snapshots"><span class="toc-text">cloudFunction update_snapshots</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%E5%B1%95%E7%A4%BA"><span class="toc-text">项目展示</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%A2%E9%98%9F%E8%BF%9B%E5%BA%A6"><span class="toc-text">团队进度</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%80%E5%8F%91%E8%BF%9B%E5%BA%A6"><span class="toc-text">开发进度</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%84%E5%91%98%E8%BF%9B%E5%BA%A6"><span class="toc-text">组员进度</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%9F%E8%AE%A1%E6%95%B0%E6%8D%AE"><span class="toc-text">统计数据</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A1%AC%E4%BB%B6%E7%AB%AF"><span class="toc-text">硬件端</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BD%AF%E4%BB%B6%E7%AB%AF"><span class="toc-text">软件端</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B0%83%E8%AF%95%E6%97%A5%E5%BF%97"><span class="toc-text">调试日志</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%80%E5%8F%91%E7%82%B9%E6%BB%B4"><span class="toc-text">开发点滴</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9F%B3%E4%B9%90%E6%8E%A8%E8%8D%90"><span class="toc-text">音乐推荐</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%B5%E5%AD%90%E7%86%8F%E9%A6%99"><span class="toc-text">电子熏香</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%99%9C"><span class="toc-text">噜</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Apple-punch"><span class="toc-text">Apple punch</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%A2%E9%98%9F%E6%95%85%E4%BA%8B"><span class="toc-text">团队故事</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Picaloe"><span class="toc-text">Picaloe</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ElliasK"><span class="toc-text">ElliasK</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Next-Dream-2020-12-07"><span class="toc-text">Next Dream.. @2020.12.07</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Recerence"><span class="toc-text">Recerence</span></a></li></ol>
    </div>
  </section>


  

  
    
    

<section class="widget text shadow blur desktop mobile">
  
  <header>
    
      <a href='www.hitokoto.cn'><i class="fas fa-comment-alt fa-fw" aria-hidden="true"></i><span class='name'>ヒトコト</span></a>
    
  </header>


  <div class='content'>
    
      <p id="hitokoto">正在加载一言...</p><script src="https://v1.hitokoto.cn/?c=a&c=b&c=c&encode=js&select=%23hitokoto" defer></script>
    
  </div>
</section>

  

  
    
    

<section class="widget text shadow blur desktop mobile">
  
  <header>
    
      <i class="fas fa-handshake fa-fw" aria-hidden="true"></i><span class='name'>Welcome!!</span>
    
  </header>


  <div class='content'>
    
      <script src="https://pv.sohu.com/cityjson?ie=utf-8"></script><script>var getOSAndBrowser=function(){var os=navigator.platform;var userAgent=navigator.userAgent;var info="";var tempArray="";if(os.indexOf("Win")>-1){if(userAgent.indexOf("Windows NT 5.0")>-1){info+="Win2000"}else if(userAgent.indexOf("Windows NT 5.1")>-1){info+="WinXP"}else if(userAgent.indexOf("Windows NT 5.2")>-1){info+="Win2003"}else if(userAgent.indexOf("Windows NT 6.0")>-1){info+="WindowsVista"}else if(userAgent.indexOf("Windows NT 6.1")>-1||userAgent.indexOf("Windows 7")>-1){info+="Win7"}else if(userAgent.indexOf("Windows NT 6.2")>-1||userAgent.indexOf("Windows 8")>-1){info+="Win8"}else if(userAgent.indexOf("Windows NT 6.3")>-1||userAgent.indexOf("Windows 8.1")>-1){info+="Win8.1"}else if(userAgent.indexOf("Windows NT 10.0")>-1||userAgent.indexOf("Windows 10")>-1){info+="Win10"}else{info+="Other"}}else if(os.indexOf("Mac")>-1){info+="Mac"}else if(os.indexOf("X11")>-1){info+="Unix"}else if(os.indexOf("Linux")>-1){info+="Linux"}else{info+="Other"}info+="/";var isOpera=userAgent.indexOf("Opera")>-1;var isIE=userAgent.indexOf("compatible")>-1&&userAgent.indexOf("MSIE")>-1&&!isOpera;var isEdge=userAgent.toLowerCase().indexOf("edge")>-1&&!isIE;var isIE11=(userAgent.toLowerCase().indexOf("trident")>-1&&userAgent.indexOf("rv")>-1);if(/[Ff]irefox(\/\d+\.\d+)/.test(userAgent)){tempArray=/([Ff]irefox)\/(\d+\.\d+)/.exec(userAgent);info+=tempArray[1]+tempArray[2]}else if(isIE){var version="";var reIE=new RegExp("MSIE (\\d+\\.\\d+);");reIE.test(userAgent);var fIEVersion=parseFloat(RegExp["$1"]);if(fIEVersion==7){version="IE7"}else if(fIEVersion==8){version="IE8"}else if(fIEVersion==9){version="IE9"}else if(fIEVersion==10){version="IE10"}else{version="0"}info+=version}else if(isEdge){info+="Edge"}else if(isIE11){info+="IE11"}else if(/[Cc]hrome\/\d+/.test(userAgent)){tempArray=/([Cc]hrome)\/(\d+)/.exec(userAgent);info+=tempArray[1]+tempArray[2]}else if(/[Vv]ersion\/\d+\.\d+\.\d+(\.\d)* *[Ss]afari/.test(userAgent)){tempArray=/[Vv]ersion\/(\d+\.\d+\.\d+)(\.\d)* *([Ss]afari)/.exec(userAgent);info+=tempArray[3]+tempArray[1]}else if(/[Oo]pera.+[Vv]ersion\/\d+\.\d+/.test(userAgent)){tempArray=/([Oo]pera).+[Vv]ersion\/(\d+)\.\d+/.exec(userAgent);info+=tempArray[1]+tempArray[2]}else{info+="unknown"}return info};document.write("Location : "+returnCitySN["cname"]);document.write("<br>IP : "+returnCitySN["cip"]);document.write("<br>Environment : "+getOSAndBrowser());</script>
    
  </div>
</section>

  

  
    
    

<section class="widget text shadow blur desktop mobile">
  
  <header>
    
      <i class="fas fa-bullhorn fa-fw" aria-hidden="true"></i><span class='name'>Announcement</span>
    
  </header>


  <div class='content'>
    
      <p>The rightmouse menu has been customized in all pages. For origional menu, please press CTRL simultaneously.</p>

    
  </div>
</section>

  

  
    
    

<section class="widget text shadow blur desktop mobile">
  
  <header>
    
      <i class="fas fa-map-marked-alt fa-fw" aria-hidden="true"></i><span class='name'>Map</span>
    
  </header>


  <div class='content'>
    
      <script type="text/javascript" src="//rf.revolvermaps.com/0/0/6.js?i=57u8duk5pjw&amp;m=7&amp;c=e63100&amp;cr1=ffffff&amp;f=arial&amp;l=0&amp;bv=90&amp;lx=-420&amp;ly=420&amp;hi=20&amp;he=7&amp;hc=a8ddff&amp;rs=80" async="async"></script>
    
  </div>
</section>

  

  
    
    

<section class="widget qrcode shadow blur desktop mobile">
  
  <header>
    
      <a href='/donatepage'><i class="fas fa-heart fa-fw" aria-hidden="true"></i><span class='name'>Donate AliPay&WePay&QQ</span></a>
    
  </header>


  <div class='content article-entry'>
    
      
        <div class='fancybox'><img src='https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/reward/qq_pic_merged_1581578634684.jpg'
        
          height='64px'
        ></div>
      
    
      
        <div class='fancybox'><img src='https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.4.2/img/reward/wepay-2-e1541232487203.png'
        
          height='64px'
        ></div>
      
    
      
        <div class='fancybox'><img src='https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/reward/qq_pic_merged_1581578554413.jpg'
        
          height='64px'
        ></div>
      
    
  </div>
</section>

  


</aside>



      </div>
      
  
  <footer class="footer clearfix">
    <br><br>
    
      
        <br>
        <div class="social-wrapper">
          
            
              <a href="/atom.xml"
                class="social  flat-btn"
                target="_blank"
                rel="external nofollow noopener noreferrer">
                
                  <img src="https://cdn.jsdelivr.net/gh/volantis-x/cdn-org@1.1/icon/1322024-social-media/020-rss.svg"/>
                
              </a>
            
          
            
          
            
              <a href="https://github.com/novaELLIAS/"
                class="social  flat-btn"
                target="_blank"
                rel="external nofollow noopener noreferrer">
                
                  <img src="https://cdn.jsdelivr.net/gh/volantis-x/cdn-org@1.1/icon/1322024-social-media/029-github.svg"/>
                
              </a>
            
          
            
              <a href="https://www.facebook.com/profile.php?id=100020334638836"
                class="social  flat-btn"
                target="_blank"
                rel="external nofollow noopener noreferrer">
                
                  <img src="https://cdn.jsdelivr.net/gh/volantis-x/cdn-org@1.1/icon/1322024-social-media/010-facebook.svg"/>
                
              </a>
            
          
            
              <a href="https://twitter.com/novaellias"
                class="social  flat-btn"
                target="_blank"
                rel="external nofollow noopener noreferrer">
                
                  <img src="https://cdn.jsdelivr.net/gh/volantis-x/cdn-org@1.1/icon/1322024-social-media/018-twitter.svg"/>
                
              </a>
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
        </div> <br>
        <div>
          <img alt="GitHub release (latest by date including pre-releases)" src="https://img.shields.io/github/v/release/novaELLIAS/novaellias.github.io?include_prereleases&label=blog%20version">
          <img alt="GitHub release (latest by date including pre-releases)" src="https://img.shields.io/github/v/release/novaELLIAS/CDN_for_ND?include_prereleases&label=CDN%20version">
          <!--
          <img alt="GitHub commits since tagged version (branch)" src="https://img.shields.io/github/commits-since/novaELLIAS/novaellias.github.io/v1.0.0/master?label=commits">
          -->
          <img alt="GitHub repo size" src="https://img.shields.io/github/repo-size/novaELLIAS/novaellias.github.io?label=blog%20size">
          <img alt="GitHub repo size" src="https://img.shields.io/github/repo-size/novaELLIAS/CDN_for_ND?label=CDN%20size">
          <img alt="PictureBed" src="https://img.shields.io/badge/PictureBed-WordPress-orange">
          <img alt="PictureBed" src="https://img.shields.io/badge/CDN-jsDelivr-orange">
        </div>
      
    
      
        <div><p>Blog content follows the <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en">Attribution-NonCommercial-ShareAlike 4.0 International (CC BY-NC-SA 4.0) License</a></p>
</div>
        <div>
          Copyright <i class="far fa-copyright"></i> 2017-2020
          <a href="https://brynhild.online/" target="_blank">ELLIAS</a> 丨
          <span id="lc-sv"><span id='number'><i class="fas fa-circle-notch fa-spin fa-fw" aria-hidden="true"></i></span> views,</span>
          <span id="lc-uv"><span id='number'><i class="fas fa-circle-notch fa-spin fa-fw" aria-hidden="true"></i></span> viewers</span> 丨
          <span id="timeDate">Loading... </span><span id="times">Loading...</span>
          <script>
            var now = new Date(); 
            function createtime() { 
              var grt= new Date("10/13/2017 21:12:13");
              now.setTime(now.getTime()+250);
              days = (now - grt ) / 1000 / 60 / 60 / 24; dnum = Math.floor(days);
              hours = (now - grt ) / 1000 / 60 / 60 - (24 * dnum); hnum = Math.floor(hours);
              if(String(hnum).length ==1 ){hnum = "0" + hnum;} minutes = (now - grt ) / 1000 /60 - (24 * 60 * dnum) - (60 * hnum); 
              mnum = Math.floor(minutes); if(String(mnum).length ==1 ){mnum = "0" + mnum;} 
              seconds = (now - grt ) / 1000 - (24 * 60 * 60 * dnum) - (60 * 60 * hnum) - (60 * mnum); 
              snum = Math.round(seconds); if(String(snum).length ==1 ){snum = "0" + snum;} 
              document.getElementById("timeDate").innerHTML = "Run Time "+dnum+" d "; 
              document.getElementById("times").innerHTML = hnum + " h " + mnum + " m " + snum + " s"; 
            } setInterval("createtime()",250);
          </script> <br>
          <img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/cn_icp.png" style="width:18px;height:18px;margin-bottom:-4px" alt="MOE ICP">
          <a href="http://www.beian.miit.gov.cn/" target="_blank"> 辽ICP备20009666号-1</a> |
          <img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/moeicp.png" style="width:18px;height:18px;margin-bottom:-4px" alt="MOE ICP">
          <a href="https://icp.gov.moe" target="_blank">MOEICP备</a><a href="https://icp.gov.moe/?keyword=20201096" target="_blank">20201096号</a>
          <br>
        </div>
      
    
  </footer>
  <script>setLoadingBarProgress(80);</script>


      <a class="s-top fas fa-arrow-up fa-fw" href='javascript:void(0)'></a>
    </div>
  </div>
  <div>
    <!-- required -->

<script src="https://cdn.jsdelivr.net/npm/jquery@3.5/dist/jquery.min.js"></script>

<script>
  function pjax_fancybox() {
    $(".md").find("img").not('.inline').not('a img').each(function () { //渲染 fancybox
      var element = document.createElement("a"); // a 标签
      $(element).attr("class", "fancybox");
      $(element).attr("pjax-fancybox", "");  // 过滤 pjax
      $(element).attr("href", $(this).attr("src"));
      if ($(this).attr("data-original")) {
        $(element).attr("href", $(this).attr("data-original"));
      }
      $(element).attr("data-fancybox", "images");
      var caption = "";   // 描述信息
      if ($(this).attr('alt')) {  // 判断当前页面是否存在描述信息
        $(element).attr('data-caption', $(this).attr('alt'));
        caption = $(this).attr('alt');
      }
      var div = document.createElement("div");
      $(div).addClass("fancybox");
      $(this).wrap(div); // 最外层套 div ，其实主要作用还是 class 样式
      var span = document.createElement("span");
      $(span).addClass("image-caption");
      $(span).text(caption); // 加描述
      $(this).after(span);  // 再套一层描述
      // 背景层
      var bgDiv = document.createElement("div");
      $(bgDiv).addClass("bg");
      if ($(this).attr('bg')) {
        $(bgDiv).css('background', $(this).attr('bg'));
      }
      $(this).wrap(bgDiv); // 背景层
      $(this).wrap(element);  // 最后套 a 标签
    })
    $(".md").find("img").fancybox({
      selector: '[data-fancybox="images"]',
      hash: false,
      loop: false,
      closeClick: true,
      helpers: {
        overlay: {closeClick: true}
      },
      buttons: [
        "zoom",
        "close"
      ]
    });
  };
  function SCload_fancybox() {
    if($(".md").find("img").not('.inline').not('a img').length+$(".article-entry").find("img").length==0)return;
    loadCSS("https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css", document.getElementById("loadcss"));
    setTimeout(function() {
      loadScript('https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js', pjax_fancybox)
    }, 1);
  };
  $(function () {
    SCload_fancybox();
  });
</script>


<!-- internal -->

  
  
  
    
<script src="https://cdn.jsdelivr.net/npm/jquery-backstretch@2.1.18/jquery.backstretch.min.js"></script>

    <script type="text/javascript">
      $(function(){
        var imgs=["https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/bg_mls_hzc.jpg", "https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/TH/fish.jpg", "https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/TH/xs.jpg", "https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/bg_summergirl.jpg", "https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.2.19/img/TH/yyz.png", "https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/TH/komeiji.png", "https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/bg_flyingboat.jpg", "https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/bg_liliw.png", "https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/bg_sagume1.jpg", "https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/bg_sao.jpg", "https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/backgrond_sayaka.jpg", "https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/bg_winter.jpg", "https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/TH/sky.jpg"];
        if ('true' == 'true') {
          function shuffle(arr){
            /*From countercurrent-time*/
            var n = arr.length;
            while(n--) {
              var index = Math.floor(Math.random() * n);
              var temp = arr[index];
              arr[index] = arr[n];
              arr[n] = temp;
            }
          }
          shuffle(imgs);
        }
        if ('') {
          $('').backstretch(
            imgs,
          {
            duration: "100000",
            fade: "4000"
          });
        } else {
          $.backstretch(
            imgs,
          {
            duration: "100000",
            fade: "4000"
          });
        }
      });
    </script>
  



  
  

  <div id="rightmenu-wrapper">
    <ul class="list-v rightmenu" id="rightmenu-content">
      <li class='option'>
        <a class='vlts-menu opt fix-cursor-default' id='menu-copy-text' onclick="document.execCommand('copy')"><i class='fa fa-copy fa-fw'></i>Copy Text</a>
        <hr id='hr-text'>
        <a class='vlts-menu opt fix-cursor-default' id='menu-copy-href'><i class='fa fa-link fa-fw'></i>Copy Link</a>
        <a class='vlts-menu opt fix-cursor-default' id='menu-open-href'><i class='fa fa-external-link-square-alt fa-fw'></i>Open Link in New Tab</a>
        <hr id='hr-href'>
        <a class='vlts-menu opt fix-cursor-default' id='menu-copy-src'><i class='fa fa-image fa-fw'></i>Copy Image Link</a>
        <hr id='hr-src'>
      </li>
      
        <li class='navigation'>
          <a class='nav icon-only fix-cursor-default' onclick='history.back()'><i class='fa fa-arrow-left fa-fw'></i></a>
          <a class='nav icon-only fix-cursor-default' onclick='history.forward()'><i class='fa fa-arrow-right fa-fw'></i></a>
          <a class='nav icon-only fix-cursor-default' onclick='window.location.reload()'><i class='fa fa-redo fa-fw'></i></a>
          <a class='nav icon-only fix-cursor-default' href='/'><i class='fa fa-home fa-fw'></i></a>
        </li>
      
      <hr>
      
        
      
        
          
    <li>
      <a class='vlts-menu fix-cursor-default' 
        
        
        
          onclick="document.execCommand('print')"
        
        >
        <i class='fa fa-print fa-fw'></i> print
      </a>
    </li>
  
        
      
        
          <hr>
        
      
        
          
    <li>
      <a class='vlts-menu fix-cursor-default' href=/archives
        
        
        
        
          id="archives"
        >
        <i class='fas fa-archive fa-fw'></i> Archive
      </a>
    </li>
  
        
      
        
          
    <li>
      <a class='vlts-menu fix-cursor-default' href=/categories/
        
        
        
        
          id="categories"
        >
        <i class='fas fa-folder-open fa-fw'></i> categories
      </a>
    </li>
  
        
      
        
          
    <li>
      <a class='vlts-menu fix-cursor-default' href=/tags/
        
        
        
        
          id="tags"
        >
        <i class='fas fa-tags fa-fw'></i> tags
      </a>
    </li>
  
        
      
        
          <hr>
        
      
        
          
    <li>
      <a class='vlts-menu fix-cursor-default' href=/aboutme/
        
        
        
        
          id="aboutme"
        >
        <i class='fas fa-address-card fa-fw'></i> About me
      </a>
    </li>
  
        
      
        
          
    <li>
      <a class='vlts-menu fix-cursor-default' href=/bloghistory/
        
        
        
        
          id="bloghistory"
        >
        <i class='fas fa-calendar fa-fw'></i> Blog History
      </a>
    </li>
  
        
      
        
          <hr>
        
      
        
          
    <li>
      <a class='vlts-menu fix-cursor-default' href=/hiddenlist/
        
        
        
        
          id="hiddenlist"
        >
        <i class='fab fa-buffer fa-fw'></i> HiddenList
      </a>
    </li>
  
        
      
        
          
    <li>
      <a class='vlts-menu fix-cursor-default' href=/donatepage/
        
        
        
        
          id="donatepage"
        >
        <i class='fas fa-heart fa-fw'></i> Donate
      </a>
    </li>
  
        
      
    </ul>
  </div>

  <script>
    window.document.oncontextmenu = function (event) {
      if (event.ctrlKey) return true;
      if (/Android|webOS|BlackBerry/i.test(navigator.userAgent)) return true;
      return popMenu(event);
    };
    document.addEventListener("click", function (event) {
      var mymenu = document.getElementById('rightmenu-wrapper');
      mymenu.style.display = "none";
    });
    function popMenu(event) {
      var mymenu = document.getElementById('rightmenu-wrapper');
      var menuContent = document.getElementById('rightmenu-content');
      var screenWidth = document.documentElement.clientWidth || document.body.clientWidth;
      var screenHeight = document.documentElement.clientHeight || document.body.clientHeight;
      mymenu.style.left = event.clientX + "px"; // 获取鼠标位置
      mymenu.style.top = event.clientY + "px";
      mymenu.style.display = 'block';
      if (event.clientX * 2 > screenWidth) {
        menuContent.classList.add('left');
      } else {
        menuContent.classList.remove('left');
      }
      if (event.clientY * 2 > screenHeight) {
        menuContent.classList.add('top');
      } else {
        menuContent.classList.remove('top');
      }

      let hrText = document.getElementById('hr-text');
      let hrSrc = document.getElementById('hr-src');
      let hrHref = document.getElementById('hr-href');

      // 选中图片
      let copySrc = document.getElementById('menu-copy-src');
      if (copySrc != undefined) {
        if (event.target.currentSrc) {
          copySrc.style.display = 'block';
          copySrc.addEventListener("click", function (e) {
            copyString(event.target.currentSrc);
          },{once: true});
          hrSrc.style.display = 'block';
        } else {
          copySrc.style.display = 'none';
          hrSrc.style.display = 'none';
        }
      }

      // 选中按钮
      // 判断是不是按钮
      let href = '';
      if (event.path) {
        for (i = 0; i < event.path.length; i++) {
          if (event.path[i].href != undefined && event.path[i].href.length > 0) {
            href = event.path[i].href;
          }
        }
      }

      let copyText = document.getElementById('menu-copy-text');
      copyText.style.display = 'none';
      hrText.style.display = 'none';
      if (href.length == 0) {
        // 选中文本
        if (window.getSelection().toString()) {
          if ('true' == 'true') {
            copyText.style.display = 'block';
            hrText.style.display = 'block';
          }
        }
      }

      // 在新标签页打开
      let openHref = document.getElementById('menu-open-href');
      if (openHref != undefined) {
        if (href.length > 0) {
          openHref.style.display = 'block';
          openHref.addEventListener("click", function (e) {
            window.open(href);
          },{once: true});
          hrHref.style.display = 'block';
        } else {
          openHref.style.display = 'none';
          hrHref.style.display = 'none';
        }
      }
      // 复制链接
      let copyHref = document.getElementById('menu-copy-href');
      if (copyHref != undefined) {
        if (href.length > 0) {
          copyHref.style.display = 'block';
          copyHref.addEventListener("click", function (e) {
            copyString(href);
          },{once: true});
        } else {
          copyHref.style.display = 'none';
        }
      }

      // 有音乐播放器
      if ('true' == true && ('home,print,hr,archieve,categories,tags,hr,aboutme,bloghistory,hr,hiddenlist,donate'||[]).includes('music')) {
        // 如果有aplayer，初始化一下
      	try {
      		checkAPlayer();
          updateTitle();
      	} catch (error) {
      		console.log(error);
      	}
      }

      return false; // 该行代码确保系统自带的右键菜单不会被调出
    }
    function hideMenu() {
      document.getElementById('rightmenu-wrapper').style.display = 'none';
    }
    function copyString(str) {
      const input = document.createElement('input');
      input.setAttribute('readonly', 'readonly');
      document.body.appendChild(input);
      input.setAttribute('value', str);
      input.select();
      document.execCommand('copy');
      document.body.removeChild(input);
    }
    document.execCommand('click');
  </script>







  <script defer src="https://cdn.jsdelivr.net/npm/vanilla-lazyload@17.1.0/dist/lazyload.min.js"></script>
<script>
  // https://www.npmjs.com/package/vanilla-lazyload
  // Set the options globally
  // to make LazyLoad self-initialize
  window.lazyLoadOptions = {
    elements_selector: ".lazyload",
    threshold: 0
  };
  // Listen to the initialization event
  // and get the instance of LazyLoad
  window.addEventListener(
    "LazyLoad::Initialized",
    function (event) {
      window.lazyLoadInstance = event.detail.instance;
    },
    false
  );
  document.addEventListener('DOMContentLoaded', function () {
    lazyLoadInstance.update();
  });
  document.addEventListener('pjax:complete', function () {
    lazyLoadInstance.update();
  });
</script>




  
  
    <script>
      window.FPConfig = {
        delay: 0,
        ignoreKeywords: [],
        maxRPS: 5,
        hoverDelay: 25
      };
    </script>
    <script defer src="https://cdn.jsdelivr.net/gh/gijo-varghese/flying-pages@2.1.2/flying-pages.min.js"></script>
  




  <script src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js"></script>
<script>
    var clipboard = new ClipboardJS('.btn-copy', {
        target: function (trigger) {
            return trigger.nextElementSibling
        }
    });
    function wait(callback, seconds) {
        var timelag = null;
        timelag = window.setTimeout(callback, seconds)
    }
    function pjax_initCopyCode() {
		if($(".highlight .code pre").length+$(".article pre code").length==0)return;
        var copyHtml = '';
        copyHtml += '<button class="btn-copy" data-clipboard-snippet="">';
        copyHtml += '<i class="fas fa-copy"></i><span>COPY</span>';
        copyHtml += '</button>';
        $(".highlight .code pre").before(copyHtml);
        $(".article pre code").before(copyHtml);
        clipboard.off('success').on('success', function (e) {
            let $btn = $(e.trigger);
            $btn.addClass('copied');
            let $icon = $($btn.find('i'));
            $icon.removeClass('fa-copy');
            $icon.addClass('fa-check-circle');
            let $span = $($btn.find('span'));
            $span[0].innerText = 'COPIED';
            wait(function () {
                $icon.removeClass('fa-check-circle');
                $icon.addClass('fa-copy');
                $span[0].innerText = 'COPY'
            }, 2000)
        });
        clipboard.off('error').on('error', function (e) {
            e.clearSelection();
            let $btn = $(e.trigger);
            $btn.addClass('copy-failed');
            let $icon = $($btn.find('i'));
            $icon.removeClass('fa-copy');
            $icon.addClass('fa-times-circle');
            let $span = $($btn.find('span'));
            $span[0].innerText = 'COPY FAILED';
            wait(function () {
                $icon.removeClass('fa-times-circle');
                $icon.addClass('fa-copy');
                $span[0].innerText = 'COPY'
            }, 2000)
        })
    }
    $(function () {
        pjax_initCopyCode()
    });
</script>






  <script>
  let APlayerController = new Object();
  APlayerController.id = '30801151';  // 设定全局音乐播放ID
  APlayerController.volume = '0.6';
</script>

  
<script src="https://cdn.jsdelivr.net/npm/aplayer@1.10/dist/APlayer.min.js"></script>


  
<script src="https://cdn.jsdelivr.net/npm/meting@2.0/dist/Meting.min.js"></script>








  
  
<script src="/js/valine.js"></script>


<script>
  var GUEST_INFO = ['nick', 'mail', 'link'];
  var meta = 'nick,mail,link'.split(',').filter(function (item) {
    return GUEST_INFO.indexOf(item) > -1
  });
  var REQUIRED_FIELDS = ['nick', 'mail', 'link'];
  var requiredFields = 'nick,mail'.split(',').filter(function (item) {
    return REQUIRED_FIELDS.indexOf(item) > -1
  });

  function emoji(path, idx, ext) {
    return path + "/" + path + "-" + idx + "." + ext;
  }

  var emojiMaps = {};
  for (var i = 1; i <= 54; i++) {
    emojiMaps['tieba-' + i] = emoji('tieba', i, 'png');
  }
  for (var i = 1; i <= 101; i++) {
    emojiMaps['qq-' + i] = emoji('qq', i, 'gif');
  }
  for (var i = 1; i <= 116; i++) {
    emojiMaps['aru-' + i] = emoji('aru', i, 'gif');
  }
  for (var i = 1; i <= 125; i++) {
    emojiMaps['twemoji-' + i] = emoji('twemoji', i, 'png');
  }
  for (var i = 1; i <= 4; i++) {
    emojiMaps['weibo-' + i] = emoji('weibo', i, 'png');
  }

  function pjax_valine() {
    if(!document.querySelectorAll("#valine_container")[0])return;

    let pagePlaceholder = $.trim($('#pjax-comment-placeholder').text()) || "Please!";

    let path = $.trim($('#pjax-comment-path').text());
    if (path.length == 0) {
      let defaultPath = '';
      path = defaultPath || decodeURI(window.location.pathname);
    }

    var valine = new Valine();
    valine.init({
      el: '#valine_container',
      meta: meta,
      placeholder: pagePlaceholder,
      path: path,
      appId: "21B1peOzTLV0I7A5xmnyUmRx-gzGzoHsz",
      appKey: "DM4Dg5a8rjqR98t4sKPjFiHC",
      pageSize: '10',
      avatar: 'mp',
      lang: 'en',
      visitor: 'true',
      highlight: 'true',
      mathJax: 'false',
      enableQQ: 'true',
      requiredFields: requiredFields,
      emojiCDN: 'https://cdn.jsdelivr.net/gh/volantis-x/cdn-emoji/valine/',
      emojiMaps: emojiMaps
    })
  }

  $(function () {
    pjax_valine();
  });
</script>




  
<script src="https://cdn.jsdelivr.net/npm/darkmode-js@1.5/lib/darkmode-js.min.js" aysc></script>

<script type="text/javascript">
function getClientHeight(){
  var clientHeight=0;
  if(document.body.clientHeight&&document.documentElement.clientHeight){
  var clientHeight = (document.body.clientHeight<document.documentElement.clientHeight)?document.body.clientHeight:document.documentElement.clientHeight;
  }else{
  var clientHeight = (document.body.clientHeight>document.documentElement.clientHeight)?document.body.clientHeight:document.documentElement.clientHeight;
  }
  return clientHeight;
}
function supportCss3(style) {
  var prefix = ['webkit', 'Moz', 'ms', 'o'],
  i,
  humpString = [],
  htmlStyle = document.documentElement.style,
  _toHumb = function (string) {
  return string.replace(/-(\w)/g, function ($0, $1) {
  return $1.toUpperCase();
  });
  };
  for (i in prefix)
  humpString.push(_toHumb(prefix[i] + '-' + style));
  humpString.push(_toHumb(style));
  for (i in humpString)
  if (humpString[i] in htmlStyle) return true;
  return false;
};
//配置信息
var options = {
  bottom: '32px',
  right: 'unset',
  left: '16px',
  time: '0s',
  mixColor: '#f4f4f4',
  backgroundColor: '#f4f4f4',
  buttonColorDark: '#333',
  buttonColorLight: '#ddd',
  saveInCookies: true,
  label: '',
  autoMatchOsTheme: true
};
// 卡片兼容处理 mix-blend-mode 与 effect: [blur] 冲突

function pjax_darkmodejs(){
  
}
// mix-blend-mode support?
if(supportCss3('mix-blend-mode')){
  window.darkmode = new Darkmode(options);
  
  window.darkmode.showWidget();
  
  pjax_darkmodejs();
}
////////////////Development///////////////////////
//////////////darkmode模式切换////////////////////
//window.darkmode.toggle();                     //
//////////////darkmode模式判断////////////////////
//console.log(window.darkmode.isActivated())    //
//////////////////////////////////////////////////
</script>





  
<script src="/js/app.js"></script>




  
    
<script src="/js/search.js"></script>

  


<!-- optional -->

  <script>
const SearchServiceimagePath="https://cdn.jsdelivr.net/gh/volantis-x/cdn-volantis@master/img/";
const ROOT =  ("/" || "/").endsWith('/') ? ("/" || "/") : ("//" || "/" );
(function ($) {
  
    customSearch = new HexoSearch({
      imagePath: SearchServiceimagePath
    });
  
})(jQuery);

</script>











  <script defer>

  const LCCounter = {
    app_id: '8HTAQTpXgAaNgP48Vp4nKHBh-MdYXbMMI',
    app_key: 'qMyEFt88I8yebS1ot9SBhHh3',
    custom_api_server: '',

    // 查询存储的记录
    getRecord(Counter, url, title) {
      return new Promise(function (resolve, reject) {
        Counter('get', '/classes/Counter?where=' + encodeURIComponent(JSON.stringify({url})))
          .then(resp => resp.json())
          .then(({results, code, error}) => {
            if (code === 401) {
              throw error;
            }
            if (results && results.length > 0) {
              var record = results[0];
              resolve(record);
            } else {
              Counter('post', '/classes/Counter', {url, title: title, times: 0})
                .then(resp => resp.json())
                .then((record, error) => {
                  if (error) {
                    throw error;
                  }
                  resolve(record);
                }).catch(error => {
                console.error('Failed to create', error);
                reject(error);
              });
            }
          }).catch((error) => {
          console.error('LeanCloud Counter Error:', error);
          reject(error);
        });
      })
    },

    // 发起自增请求
    increment(Counter, incrArr) {
      return new Promise(function (resolve, reject) {
        Counter('post', '/batch', {
          "requests": incrArr
        }).then((res) => {
          res = res.json();
          if (res.error) {
            throw res.error;
          }
          resolve(res);
        }).catch((error) => {
          console.error('Failed to save visitor count', error);
          reject(error);
        });
      });
    },

    // 构建自增请求体
    buildIncrement(objectId) {
      return {
        "method": "PUT",
        "path": `/1.1/classes/Counter/${ objectId }`,
        "body": {
          "times": {
            '__op': 'Increment',
            'amount': 1
          }
        }
      }
    },

    // 校验是否为有效的 UV
    validUV() {
      var key = 'LeanCloudUVTimestamp';
      var flag = localStorage.getItem(key);
      if (flag) {
        // 距离标记小于 24 小时则不计为 UV
        if (new Date().getTime() - parseInt(flag) <= 86400000) {
          return false;
        }
      }
      localStorage.setItem(key, new Date().getTime().toString());
      return true;
    },

    addCount(Counter) {
      var enableIncr = '' === 'true' && window.location.hostname !== 'localhost';
      enableIncr = true;
      var getterArr = [];
      var incrArr = [];
      // 请求 PV 并自增
      var pvCtn = document.querySelector('#lc-sv');
      if (pvCtn || enableIncr) {
        var pvGetter = this.getRecord(Counter, 'https://brynhild.online' + '/#lc-sv', 'Visits').then((record) => {
          incrArr.push(this.buildIncrement(record.objectId))
          var eles = document.querySelectorAll('#lc-sv #number');
          if (eles.length > 0) {
            eles.forEach((el,index,array)=>{
              el.innerText = record.times + 1;
              if (pvCtn) {
                pvCtn.style.display = 'inline';
              }
            })
          }
        });
        getterArr.push(pvGetter);
      }

      // 请求 UV 并自增
      var uvCtn = document.querySelector('#lc-uv');
      if (uvCtn || enableIncr) {
        var uvGetter = this.getRecord(Counter, 'https://brynhild.online' + '/#lc-uv', 'Visitors').then((record) => {
          var vuv = this.validUV();
          vuv && incrArr.push(this.buildIncrement(record.objectId))
          var eles = document.querySelectorAll('#lc-uv #number');
          if (eles.length > 0) {
            eles.forEach((el,index,array)=>{
              el.innerText = record.times + (vuv ? 1 : 0);
              if (uvCtn) {
                uvCtn.style.display = 'inline';
              }
            })
          }
        });
        getterArr.push(uvGetter);
      }

      // 请求文章的浏览数，如果是当前页面就自增
      var allPV = document.querySelectorAll('#lc-pv');
      if (allPV.length > 0 || enableIncr) {
        for (i = 0; i < allPV.length; i++) {
          let pv = allPV[i];
          let title = pv.getAttribute('data-title');
          var url = 'https://brynhild.online' + pv.getAttribute('data-path');
          if (url) {
            var viewGetter = this.getRecord(Counter, url, title).then((record) => {
              // 是当前页面就自增
              if (pv.getAttribute('data-path') == window.location.pathname) {
                incrArr.push(this.buildIncrement(record.objectId));
              }
              if (pv) {
                var ele = pv.querySelector('#lc-pv #number');
                if (ele) {
                  if (pv.getAttribute('data-path') == window.location.pathname) {
                    ele.innerText = (record.times || 0) + 1;
                  } else {
                    ele.innerText = record.times || 0;
                  }
                  pv.style.display = 'inline';
                }
              }
            });
            getterArr.push(viewGetter);
          }
        }
      }

      // 如果启动计数自增，批量发起自增请求
      if (enableIncr) {
        Promise.all(getterArr).then(() => {
          incrArr.length > 0 && this.increment(Counter, incrArr);
        })
      }

    },


    fetchData(api_server) {
      var Counter = (method, url, data) => {
        return fetch(`${ api_server }/1.1${ url }`, {
          method,
          headers: {
            'X-LC-Id': this.app_id,
            'X-LC-Key': this.app_key,
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(data)
        });
      };
      this.addCount(Counter);
    },

    refreshCounter() {
      var api_server = this.app_id.slice(-9) !== '-MdYXbMMI' ? this.custom_api_server : `https://${ this.app_id.slice(0, 8).toLowerCase() }.api.lncldglobal.com`;
      if (api_server) {
        this.fetchData(api_server);
      } else {
        fetch('https://app-router.leancloud.cn/2/route?appId=' + this.app_id)
          .then(resp => resp.json())
          .then(({api_server}) => {
            this.fetchData('https://' + api_server);
          });
      }
    }

  };

  LCCounter.refreshCounter();

  document.addEventListener('pjax:complete', function () {
    LCCounter.refreshCounter();
  });
</script>



<!-- more -->


    
      


<script src="https://cdn.jsdelivr.net/npm/pjax@0.2.8/pjax.min.js"></script>

<!-- 样式位于：source/css/_third-party/pjaxanimate.styl -->

<div class="pjax-animate">
  
    <script src="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.js"></script>
    <div id="loading-bar-wrapper"><script>NProgress.configure({parent:"#loading-bar-wrapper",trickleSpeed: 100})</script></div>
    <script>
      window.ShowLoading = function() {
        NProgress.start();
      };
      window.HideLoading = function() {
        NProgress.done();
      }
    </script>
  
</div>

<script>
    var pjax;
    document.addEventListener('DOMContentLoaded', function () {
      pjax = new Pjax({
        elements: 'a[href]:not([href^="#"]):not([href="javascript:void(0)"]):not([pjax-fancybox])',
        selectors: [
          "title",
          "#pjax-container",
          "#pjax-header-nav-list"
        ],
        cacheBust: false,   // url 地址追加时间戳，用以避免浏览器缓存
        timeout: 5000
      });
    });

    document.addEventListener('pjax:send', function (e) {
      window.stop(); // 相当于点击了浏览器的停止按钮

      try {
        var currentUrl = window.location.pathname;
        var targetUrl = e.triggerElement.href;
        var banUrl = ["/webboard/"];
        if (banUrl[0] != "") {
          banUrl.forEach(item => {
            if(currentUrl.indexOf(item) != -1 || targetUrl.indexOf(item) != -1) {
              window.location.href = targetUrl;
            }
          });
        }
      } catch (error) {}

      window.subData = null; // 移除标题（用于一二级导航栏切换处）
      if (typeof $.fancybox != "undefined") {
        $.fancybox.close();    // 关闭弹窗
      }
      $('.l_header .switcher .s-search').removeClass('active'); // 关闭移动端激活的搜索框
      $('.l_header').removeClass('z_search-open'); // 关闭移动端激活的搜索框
      $('.wrapper').removeClass('sub'); // 跳转页面时关闭二级导航

      // 解绑事件 避免重复监听
      $('.s-top').unbind('click');
      $('.menu a').unbind('click');
      $(window).unbind('resize');
      $(window).unbind('scroll');
      $(document).unbind('scroll');
      $(document).unbind('click');
      $('body').unbind('click');
      window.ShowLoading();
    });

    document.addEventListener('pjax:complete', function () {
      // 关于百度统计对 SPA 页面的处理：
      // 方案一：百度统计>管理>单页应用设置中，打开开启按钮即可对SPA进行统计。 https://tongji.baidu.com/web/help/article?id=324
      // 方案二：取消注释下列代码。 https://tongji.baidu.com/web/help/article?id=235
      // 

      // 关于谷歌统计对 SPA 页面的处理：
      // 当应用以动态方式加载内容并更新地址栏中的网址时，也应该更新通过 gtag.js 存储的网页网址。
      // https://developers.google.cn/analytics/devguides/collection/gtagjs/single-page-applications?hl=zh-cn
      
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('config', 'UA-141886684-1', {'page_path': document.location.pathname});
      

      $('.nav-main').find('.list-v').not('.menu-phone').removeAttr("style",""); // 移除小尾巴的移除
      $('.menu-phone.list-v').removeAttr("style",""); // 移除小尾巴的移除
      $('script[data-pjax], .pjax-reload script').each(function () {
        $(this).parent().append($(this).remove());
      });
      try{
          if (typeof $.fancybox == "undefined") {
            SCload_fancybox();
          } else {
            pjax_fancybox();
          }
        
          
          if ('') {
            $('').backstretch("resize");
            if($('.cover-wrapper').is(':hidden')){
              $('.cover-backstretch').backstretch("pause");
            }else{
              $('.cover-backstretch').backstretch("next");
            }
          } else {
            $.backstretch("resize");
            if($('.cover-wrapper').is(':hidden')){
              $.backstretch("pause");
            }else{
              $.backstretch("next");
            }
          }
        
        
        
        
          pjax_initCopyCode();
        
        
          pjax_valine();
        
        
        
        
        
          pjax_darkmodejs();
        
      } catch (e) {
        console.log(e);
      }
      window.HideLoading();
    });

    document.addEventListener('pjax:error', function (e) {
      window.HideLoading();
      window.location.href = e.triggerElement.href;
    });
</script>

    
  </div>
<script async>window.onload=function(){var a=document.createElement('script'),b=document.getElementsByTagName('script')[0];a.type='text/javascript',a.async=!0,a.src='/sw-register.js?v='+Date.now(),b.parentNode.insertBefore(a,b)};</script></body></html>